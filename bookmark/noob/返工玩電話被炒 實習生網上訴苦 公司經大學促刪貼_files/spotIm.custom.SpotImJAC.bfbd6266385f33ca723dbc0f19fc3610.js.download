var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))((function(i,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function r(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(a,r)}c((n=n.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var o,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(s){return function(r){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{o=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,r])}}},__spreadArray=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var n,i=0,s=e.length;i<s;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};!function(){var t="messages-count",e="navigate",o="scroll-lock",n="scroll-release",i="spotim_error",s="spotim_event",a="sso_api_ready",r="spot-im-renew-sso",c="sso_code_a",d="sso_login_error",l="sso_login_success",m="storage_update",p="spot-im-share-type",u="spot-im-conversation-failed",h="spot-im-conversation-loaded",f="ow-error-event",v="spot-im-launcher-failed",g="ow-performance-event",w="spot-im-show-more-replies-clicked",_="spot-im-show-more-comments-clicked",S="spot-im-sort-by-select",C="spot-im-user-down-vote-click",I="spot-im-user-up-vote-click",y="spot-im-clicked-settings",A="spot-im-login-start",E="spot-im-clicked-mute-user",O="spot-im-user-clicked-reply",b="spot-im-clicked-privacy",k="spot-im-clicked-flag",N="spot-im-current-user-sent-message-clicked",T="logout",R="startSafeframeSso",P="completeSSOCallback",M="modal",D="deeplink",L="qsp",J="conversation",x=function(){function x(t){var e,o,n;if(this.CONVERSATIONS_POSITION_NAME="OpenWebWidget",this.CONVERSATIONS_NODE_ID="spotIm-conversations-module-wrapper",this.LIGHTBOX_HEADER_CLASSNAME="wafer-lightbox-spotIm-header",this.LIGHTBOX_AD_NODE_ID="sda-WFPAD2",this.LIGHTBOX_AD_ID="WFPAD2",this.DARLA_AD_REFRESH_EVENT="refreshAdsOnCommentActions",this.DARLA_WFPAD2_REFRESH_EVENT="wfpad2Fetch",this.UPDATE_STORAGE_THROTTLE_MS=500,this.SPOT_IM_QUERY_PREFIXES=["openweb_","ow_","spot_im","spot_reset_password","spot_ticket","spotim_","tenant_config"],this.NAVIGATE_ALLOWED_LIST=["https://www.yahoo.com","https://api-2-0.spot.im","mailto:"],this.isDebug=!1,this.isStaging=!1,this.devJACVersion="",this.RRFirstAdSlotPosCount=0,this.RRSecondAdSlotPosCount=0,this.RRThirdAdSlotPosCount=0,this.minCommentCountToSlotAds=2,this.modalJacPositionsMap={},t){this.spotImConfiguration=t,void 0===this.spotImConfiguration.conversationEnabled&&(this.spotImConfiguration.conversationEnabled=!0),this.pageContext=__assign(__assign({},null===(e=window.YAHOO)||void 0===e?void 0:e.context),null===(n=null===(o=window.vzm)||void 0===o?void 0:o.getPageContext)||void 0===n?void 0:n.call(o));try{this.isDebug="1"===localStorage.getItem("SPOTIM_JAC_DEBUG"),"1"===localStorage.getItem("SPOTIM_JAC_STAGE")&&(this.isStaging=!0);var i=localStorage.getItem("SPOTIM_JAC_VERSION")||"";i&&/^(\d+)\.(\d+)\.(\d+)$/.test(i)&&(this.devJACVersion=i)}catch(t){}this.updateStorageThrottled=window.wafer.utils.throttle(this.updateStorage,this.UPDATE_STORAGE_THROTTLE_MS,this);try{this.initialize()}catch(t){console.error(t),this.sendBeacon("spotIm-init-error",{message:t.message})}}else console.error("SpotImJAC: invalid configuration")}return x.prototype.getIsOpenWebParam=function(){var t=this;return window.location.search.slice(1).split("&").some((function(e){return t.SPOT_IM_QUERY_PREFIXES.some((function(t){return 0===e.split("=")[0].indexOf(t)}))}))},x.prototype.injectJAC=function(){var t=this,e=this.spotImConfiguration,o=e.enableFocusProtection,n=e.jacUrl;return new Promise((function(e,i){var s=function(){e(),window.JAC.on("AD_MESSAGE",(function(e){var o=e.meta;try{var n=o.message,i=void 0===n?"":n,s=o.positionName,a=JSON.parse(i),r=a.type,c=a.messages,d=void 0===c?[]:c;if("spotim"!==String(r).toLowerCase())return;d.forEach((function(e){return t.onMessageFromJAC(s,e)}))}catch(e){console.error(e),t.sendBeacon("spotIm-on-ad-message-fail")}}))};if(window.JAC_CONFIG={client:{focusProtection:!1,positions:{},onReady:s}},o&&(window.JAC_CONFIG.client.focusProtection=!0),window.JAC)s();else{var a=document.createElement("script");a.async=!0,a.src=n,t.devJACVersion&&(a.src="https://jac.yahoosandbox.com/".concat(t.devJACVersion,"/jac.js")),a.onerror=function(e){console.error(e),t.sendBeacon("spotIm-jac-inject-fail",{message:e}),i(e)},document.body.appendChild(a)}}))},x.prototype.initialize=function(){var t=this,e=this.spotImConfiguration,o=e.useCase,n=e.jacDomain,i=e.device,s=void 0===i?"":i,a=this.pageContext.device,r="smartphone"===(void 0===a?s:a);switch(window.JAC_BASE_URL=n,o){case D:this.injectJAC().then((function(){r?t.initForDeeplinkMobile():t.initForDeeplink()}));break;case M:this.initForModal(r);break;case L:this.initForQSP();break;default:throw new Error("Unknown useCase '".concat(o,"' given"))}},x.prototype.initForQSP=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.injectJAC()];case 1:return o.sent(),t=document.getElementById(this.CONVERSATIONS_NODE_ID),e=this.getJACPositionConfig({spotImConfig:this.spotImConfiguration,spotImType:J,targetElement:t,useCase:L}),window.JAC.createPosition(this.CONVERSATIONS_POSITION_NAME,{client:e,service:{}}),window.JAC.render([this.CONVERSATIONS_POSITION_NAME]),[2]}}))}))},x.prototype.initForDeeplink=function(){var t=this.spotImConfiguration,e=t.conversationEnabled,o=t.uuid;if(e){var n=document.getElementById(this.CONVERSATIONS_NODE_ID),i=document.querySelector(".caas-share-buttons .caas-comment");this.scrollToCommentsIfNeeded(n,i,o);var s=this.getJACPositionConfig({spotImConfig:this.spotImConfiguration,spotImType:J,targetElement:n,useCase:D});window.JAC.createPosition(this.CONVERSATIONS_POSITION_NAME,{client:s,service:{}}),window.JAC.render([this.CONVERSATIONS_POSITION_NAME])}},x.prototype.initForDeeplinkMobile=function(){this.spotImConfiguration.conversationEnabled&&(this.openMobileModalIfNeeded(),this.initForLightbox(this.spotImConfiguration))},x.prototype.initForModal=function(t){var e=this,o=this.spotImConfiguration,n=o.conversationEnabled,i=o.initLauncherOnClick,s=void 0!==i&&i,a=o.showSuspendedCommentsMessage,r=o.showViewCommentsCTA,c=this.injectJAC(),d=function(){for(var t=Object.keys(e.modalJacPositionsMap);t.length;){var o=t.pop();window.JAC.destroyPosition(o)}e.modalJacPositionsMap={}},l=function(o){var i=o.detail,s=i.elem,r=i.config,d=i.isMain;if(n&&c.then((function(){return e.initCommentsInModal(s,r,d,t)})),!t&&a){var l=document.getElementById("suspended-commenting-message-template");l&&(s.innerText=l.content.textContent,s.className=l.className)}};if(!t&&r&&!s){var m=B(),p=document.getElementById(this.CONVERSATIONS_NODE_ID),u=window.YAHOO.context.meta,h=u.commentsCount,f=void 0===h?"0":h,v=u.title,g=u.url,w=u.uuid,_=__assign(__assign({commentsCount:f},m),{title:encodeURIComponent(v),url:g,uuid:w});l({detail:{config:__assign({},_),elem:p,isMain:!0}})}window.addEventListener("initSpotImComments",l),window.addEventListener("viewerContentChanged",d),window.addEventListener("viewerClosed",d)},x.prototype.initForLightbox=function(t,e){var o=this;void 0===e&&(e=D);var n=function(){var t,n,i=B();if(i.showAdOnLightBox&&document.getElementById(o.LIGHTBOX_AD_NODE_ID)){var s=window.adsConfig,a=window.DARLA,r=a.config()&&a.config().positions;if((null===(t=null==s?void 0:s.clientPositionMeta)||void 0===t?void 0:t.positions.length)&&(!r||!r[o.LIGHTBOX_AD_ID])){var c=null===(n=null==s?void 0:s.clientPositionMeta)||void 0===n?void 0:n.positions.filter((function(t){return t.id===o.LIGHTBOX_AD_ID}));c.length&&a.addPos(c[0])}o.refreshAds()}var d=document.getElementById(o.CONVERSATIONS_NODE_ID);if(d){var l=o.getJACPositionConfig({spotImConfig:i,spotImType:J,targetElement:d,useCase:e});window.JAC.createPosition(o.CONVERSATIONS_POSITION_NAME,{client:l,service:{}}),window.JAC.render([o.CONVERSATIONS_POSITION_NAME])}},i=function(){document.getElementById(o.CONVERSATIONS_NODE_ID)&&window.JAC.destroyPosition(o.CONVERSATIONS_POSITION_NAME)},s=window.wafer;s.removeListener&&(s.removeListener("lightbox:open",n),s.removeListener("lightbox:close",i)),s.on("lightbox:open",n),s.on("lightbox:close",i);var a=document.getElementById("view-comments-wrapper"),r=document.getElementById("spot-im-wafer-lightbox");a&&r&&a.addEventListener("click",(function(){r.click()}))},x.prototype.initCommentsInModal=function(t,e,o,n){var i=o?this.CONVERSATIONS_POSITION_NAME:"".concat(this.CONVERSATIONS_POSITION_NAME,"-").concat(e.uuid);if(n)this.initForLightbox(e,M),this.openMobileModalIfNeeded();else{var s=e.showRightRailAds,a=void 0!==s&&s,r=e.uuid,c=document.querySelector("[data-comments-id=".concat(t.id,"] .caas-share-buttons .caas-comment"));this.scrollToCommentsIfNeeded(t,c,r);var d=t;a&&(this.addSpotImRightRailMarkup(t,e),d=document.getElementById("".concat(t.id)));var l=this.getJACPositionConfig({spotImConfig:e,spotImType:J,targetElement:d,useCase:M});window.JAC.createPosition(i,{client:l,service:{}}),window.JAC.render([i])}this.modalJacPositionsMap[i]=e},x.prototype.getConversationStyles=function(t){var e=t.useCase,o=t.isMobile,n=t.shareSectionWidth,i=t.contentWidth;if(t.isHorizontalLayoutPage)return"#spotIm-in-jac-conversations.deeplink-desktop, #spotIm-in-jac-conversations.deeplink-desktop.news-en-US {\n                        position: relative;\n                        margin: auto;\n                        width: 830px;\n                        left: unset;\n                }";switch(e){case D:return o?"#spotIm-in-jac-conversations.deeplink-smartphone {\n                            width: calc(100% - 20px);\n                            margin: 0 auto;\n                        }":"#spotIm-in-jac-conversations.deeplink-desktop {\n                        width: calc(85% - 300px);\n                        margin-left: ".concat(n,"px;\n                    }\n                    #spotIm-in-jac-conversations.deeplink-desktop.adsStreamLayout {\n                        width: 75%;\n                    }\n                    #spotIm-in-jac-conversations.deeplink-desktop.news-en-US {\n                        width: 85%;\n                        position: relative;\n                        left: 9%;\n                        margin-left: ").concat(n,"px;\n                    }");case M:return"#spotIm-in-jac-conversations.modal-desktop {\n                        width: ".concat(i,"px;\n                        margin-left: ").concat(n,"px;\n                        padding-right: 10%;\n                    }");case L:return"#spotIm-in-jac-conversations.qsp-desktop {\n                        width: 100%;\n                        margin-left: ".concat(n,"px;\n                    }\n                    #spotIm-in-jac-conversations .spot-im-conversation-module {\n                        margin: 0;\n                    }");default:return""}},x.prototype.getJACPositionConfig=function(t){var e,o,n=this,i=t.spotImConfig,s=t.targetElement,a=t.spotImType,r=t.useCase;if(["spotImConfig","targetElement","spotImType","useCase"].forEach((function(e){if(!t[e])throw new Error("getJACPositionConfig: param '".concat(e,"' is missed"))})),!s.id)throw new Error("getJACPositionConfig: targetElement doesn't have required DOM id attribute");var c=i.commentsCount,d=void 0===c?"0":c,l=i.device,m=void 0===l?"":l,p=i.launcherUrl,u=i.leftRailWidth,h=void 0===u?"":u,f=i.messages_cnt,v=i.passiveReactionEnabled,g=i.showRightRailAds,w=void 0!==g&&g,_=i.showViewCommentsCTA,S=void 0!==_&&_,C=i.stageSpotId,I=i.url,y=i.uuid,A=i.spotId;this.isStaging&&C&&(A=C);var E=p+A,O=this.pageContext,b=O.device,k=void 0===b?m:b,N=O.contentSite,T=void 0===N?"":N,R=O.site,P=void 0===R?"":R,M=O.lang,D=void 0===M?"":M,x=O.meta,B=void 0===x?{}:x,F=B.contentType,j=void 0===F?"story":F,V=B.siteAttribute,W=void 0===V?"":V,H="smartphone"===k,q=a===J,U=H&&document.getElementsByClassName(this.LIGHTBOX_HEADER_CLASSNAME)&&document.getElementsByClassName(this.LIGHTBOX_HEADER_CLASSNAME)[0],G=U&&U.offsetHeight||57,X=this.checkCommentCount(d),z=s.offsetWidth;if(S&&!z){var Y=document.getElementById("view-cmts-container-".concat(y));z=w&&X?Y.offsetWidth-320:Y.offsetWidth}var Q=H&&q?window.innerWidth:z,$=H?window.innerHeight-G-70:330,Z=h||(null===(e=document.querySelector("#Masterwrap .caas-share-section, #content-articles-wrapper .caas-share-section"))||void 0===e?void 0:e.clientWidth)||0,K=(null===(o=document.querySelector(".caas-content-wrapper"))||void 0===o?void 0:o.clientWidth)||0,tt=document.getElementsByClassName("adsStreamWrapper")[0],et=document.querySelector("#Masterwrap2Col.horizontalLayout"),ot=this.getConversationStyles({useCase:r,isMobile:H,isHorizontalLayoutPage:et,shareSectionWidth:Z,contentWidth:K}),nt=new URL(I);if("qsp"!==r){nt.searchParams.append("ref","spot-im-jac")}var it=nt.toString(),st=__spreadArray([],/rs="lmsid:([\w]+);?/gi.exec(W)||[],!0)[1],at=void 0===st?"yahoo":st,rt="";try{rt=localStorage.getItem("OW_STORAGE")||""}catch(t){s.style.display="none",console.error("SpotIm(JAC) OW_STORAGE LS read error: ",t),this.sendBeacon("spotIm-ow-storage-LS-read-error")}var ct=window.location.search.slice(1).split("&").filter((function(t){return n.SPOT_IM_QUERY_PREFIXES.some((function(e){var o=t.split("="),n=o[0],i=o[1];return"ref"===n&&0===(void 0===i?"":i).indexOf("spot-im")||0===n.indexOf(e)}))})).join("&"),dt=window.location.href.split("?")[0]+(ct?"?".concat(ct):""),lt=T||P;"finance"!==P&&"sports"!==P||(lt=P);var mt=v?"data-labels-section=".concat("finance"===lt&&r===L?"stock":lt):"",pt="modal"!==r?"data-custom-product-type=non-modal":"data-custom-product-type=modal";if(a!==J)throw new Error("Unexpected spotImType: ".concat(a));return{safeFrame:{enabled:!0,features:{resize:{enabled:!0}}},meta:{OpenWeb:{hostUrl:dt,localStorage:rt}},content:{markup:"\n                        ".concat("qsp"===r?'<meta name="filter-finmb"/>':"","\n                        <style>\n                            #fc_align {\n                                width: 100%;\n                                ").concat(H?"overflow-y: auto; height: 100%;":"","\n                            }\n                            ").concat(ot,'\n                        </style>\n                        <div id="spotIm-in-jac-conversations" class="').concat(r,"-").concat(k," ").concat(lt,"-").concat(D).concat(tt?" adsStreamLayout":"",'">\n                            <script\n                                async\n                                type="text/javascript"\n                                src="').concat(E,'"\n                                data-safeframe-height="').concat($,'"\n                                data-safeframe-width="').concat(Q,'"\n                                data-spotim-module="spotim-launcher"\n                                data-spot-id="').concat(A,'"\n                                data-post-id="').concat(y,'"\n                                data-post-url="').concat(it,'"\n                                data-article-tags="').concat(lt,'"\n                                data-custom-page-structure="additive"\n                                data-is-full-screen="').concat(H,'"\n                                data-messages-count="').concat(f,'"\n                                data-custom-partner-id="').concat(at,'"\n                                data-custom-page-type="').concat(j,'"\n                                data-custom-product-id="yahoo_').concat(lt,'"\n                                ').concat(mt,"\n                                ").concat(pt,"\n                                ").concat("qsp"===r?"data-post-staleness-days=0":"","\n                            >\n                            <\/script>\n                        </div>"),size:{width:Q,height:$}},targetElement:s.id}},x.prototype.onMessageFromJAC=function(p,u){var h=u.action,f=u.args;this.debugLog("onMessageFromJAC",{action:h,args:f,positionName:p});var v=this.modalJacPositionsMap[p]||this.spotImConfiguration;switch(h){case a:case r:this.onSSOReady(p);break;case c:this.startSSOFlow(f.code_a,v,p);break;case d:this.sendBeacon("spotIm-sso-fail");break;case l:this.sendBeacon("spotIm-sso-success")}switch(h){case s:var g=f.params,w=f.type;this.onSpotImEvent(w,g,v,p);break;case m:var _=f.storage;this.updateStorageThrottled(_);break;case e:var S=f.url;this.openLinkFromSpotIm(S);break;case i:var C=f.type,I=f.error;this.sendBeacon("spotIm-inner-error",{type:C,error:I});break;case o:window.document.body.classList.add("ow-modal-opened");break;case n:window.document.body.classList.remove("ow-modal-opened");break;case t:var y=Number(f),A=v.uuid;if(!isNaN(y)){var E=document.querySelector('.reactions-count[data-id="'.concat(A,'"]'));E&&(E.innerHTML="".concat(y),E.setAttribute("style","display:block"))}}},x.prototype.onSpotImEvent=function(t,e,o,n){var i=this;this.debugLog("onSpotImEvent",{eventName:t,params:e});var s=function(t){i.sendRapid(t,o)},a=o.showViewCommentsCTA,r=o.initLauncherOnClick,c=void 0!==r&&r,d=o.showRightRailAds,l=void 0!==d&&d,m=o.uuid,T=e||{},R=T.message_id,P=void 0===R?"":R,M=T.parent_id,D=void 0===M?"":M,L=T.message_type,J=void 0===L?"":L;switch(t){case A:this.goToAuth();break;case E:s({slk:"mute",elm:"cmmt_mute",outcm:"close"});break;case p:var x=e.type;s({slk:void 0===x?"":x,elm:J?"cmmt_share_"+J:"cmmt_share",msg_id:P,outcm:"open",parent_id:D});break;case S:var B=e.sortedBy;s({slk:void 0===B?"":B,elm:"cmmt_sort_btn",outcm:"sort"});break;case N:this.refreshAds(),s({slk:J,elm:"cmmt_post",msg_id:D,outcm:"post"});break;case O:this.refreshAds(),s({slk:"reply",elm:"cmmt_reply"});break;case w:this.refreshAds(),s({slk:"open reply",elm:"cmmt_more",elmt:"showreply",outcm:"show",parent_id:D,msg_id:P,sec:"cmmts"});break;case k:s({slk:"abuse",elm:"cmmt_abuse",outcm:"open",msg_id:P,parent_id:D});break;case b:s({slk:"privacy",elm:"cmmt_username",sec:"cmmt_his"});break;case y:s({slk:"your settings",elm:"cmmt_username",sec:"cmmt_his"});break;case I:s({slk:"vote thumb_up",elm:"cmmt_vote",parent_id:D,msg_id:P,outcm:"rate"});break;case C:s({slk:"vote thumb_down",elm:"cmmt_vote",parent_id:D,msg_id:P,outcm:"rate"});break;case _:this.refreshAds(),l&&this.loadRightRailAdSlot(o),this.updateUser(o),s({slk:"load more",elm:"cmmt_more",outcm:"more"});break;case u:case v:this.sendBeacon("spotIm-inner-fail:".concat(t));break;case h:if(l&&this.initRightRailAds(m),a&&!c)return;window.rapidInstance.beaconEvent("openweb_module_view",{sec:"cmmts",subsec:"openweb",etrg:"show",outcm:"openweb_module_view"});break;case g:this.reportPerformance(e);break;case f:this.reportError(e)}},x.prototype.refreshAds=function(){var t=window.DARLA,e=null==t?void 0:t.evtSettings(this.DARLA_AD_REFRESH_EVENT),o=null==t?void 0:t.evtSettings(this.DARLA_WFPAD2_REFRESH_EVENT);e&&e.ps&&t.event(this.DARLA_AD_REFRESH_EVENT),o&&o.ps&&t.event(this.DARLA_WFPAD2_REFRESH_EVENT)},x.prototype.goToAuth=function(){var t=this.pageContext,e=t.lang,o=void 0===e?"en-US":e,n=t.site,i="fp"===n?"homepage":n,s=window.YAHOO.i13n&&window.YAHOO.i13n.SPACEID||2023538075,a=window.location.href+(window.location.search?"&":"?")+"a20_comeback_from_auth=1",r="https://login.yahoo.com/?.lang=".concat(o,"&src=").concat(i,"&pspid=").concat(s,"&activity=comments&.done=").concat(encodeURIComponent(a));window.location.href=r},x.prototype.onSSOReady=function(t){var e=this.pageContext,o=e.authed,n=void 0===o?"0":o,i=e.guid;"1"===n?this.sendMessageToJAC({action:R,args:{userId:i}},t):this.sendMessageToJAC({action:T},t)},x.prototype.sendMessageToJAC=function(t,e){var o=Math.random().toString(36).substring(2,15)+Date.now();this.debugLog("sendMessageToJAC",t),window.JAC.updateMeta([e||this.CONVERSATIONS_POSITION_NAME],"openWeb",JSON.stringify(__assign({type:"SPOTIM",id:o},t)))},x.prototype.startSSOFlow=function(t,e,o){var n=this;this.debugLog("startSSOFlow",{codeA:t});var i=e.xhrPathPrefix,s=e.useStageToken,a=void 0!==s&&s,r=e.useCase,c=e.spotId,d=e.stageSpotId,l="".concat(i,"?m_id=spotIm&ctrl=SpotImSSO&m_mode=json");fetch(l,{body:JSON.stringify({m_id:"spotIm",ctrl:"SpotImSSO",m_mode:"json",code_a:t,useStageToken:Boolean(a||this.isStaging),useCase:r,spotId:this.isStaging?d:c}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(t){if(200!==t.status)throw new Error("Request error");return t.json()})).then((function(t){var e=t.html;if(!e)throw new Error("SpotIm: codeB getting error");n.sendMessageToJAC({action:P,args:e},o)})).catch((function(t){n.sendBeacon("spotIm-sso-fail")}))},x.prototype.updateStorage=function(t){try{localStorage.setItem("OW_STORAGE",JSON.stringify(t))}catch(t){this.sendBeacon("spotIm-storage-update-fail")}},x.prototype.openLinkFromSpotIm=function(t){void 0===t&&(t=""),this.NAVIGATE_ALLOWED_LIST.some((function(e){return 0===t.indexOf(e)}))&&(window.location.href=t)},x.prototype.sendBeacon=function(t,e){var o,n,i,s,a;void 0===e&&(e={});var r=this.pageContext,c=["browserName","device","lang","region","rid","site"].reduce((function(t,e){return"".concat(t,"&").concat(e,"=").concat(r[e]||"")}),""),d=Object.keys(e).reduce((function(t,o){return"".concat(t,"&").concat(o,"=").concat(e[o])}),""),l=(null===(n=null===(o=window.YAHOO)||void 0===o?void 0:o.errBeaconConfig)||void 0===n?void 0:n.beaconPath)||"_td_api/beacon/error";null===(a=null===(s=null===(i=window.wafer)||void 0===i?void 0:i.utils)||void 0===s?void 0:s.fireBeacon)||void 0===a||a.call(s,"/".concat(l,"?beaconName=").concat(t).concat(d).concat(c))},x.prototype.sendRapid=function(t,e){var o=t.elm,n=void 0===o?"":o,i=t.elmt,s=void 0===i?"":i,a=t.eventType,r=void 0===a?"click":a,c=t.itc,d=void 0===c?1:c,l=t.msg_id,m=void 0===l?"":l,p=t.parent_id,u=void 0===p?"":p,h=t.noContent,f=void 0!==h&&h,v=t.outcm,g=void 0===v?"":v,w=t.pos,_=void 0===w?0:w,S=t.sec,C=void 0===S?"cmmts":S,I=t.slk,y=void 0===I?"":I,A=t.subsec,E=void 0===A?"openweb":A,O=t.tar,b=void 0===O?"":O,k=t.tar_uri,N=void 0===k?"":k,T=e.uuid;if(window.rapidInstance){var R={elm:n,elmt:s,g:"",itc:d,outcm:g,subsec:E,tar:b,tar_uri:N,msg_id:m,parent_id:u};R.g=f?"":T,"view"===r?window.rapidInstance.beaconLinkViews([{sec:C,_links:[{slk:y,elm:n,itc:d}]}]):"click"===r&&window.rapidInstance.beaconClick(C,y,_,R)}},x.prototype.scrollToCommentsIfNeeded=function(t,e,o){var n=t||document.getElementById(this.CONVERSATIONS_NODE_ID);if(n){var i=this.getIsOpenWebParam(),s=function(){var t=document.querySelector("#view-cmts-container-".concat(o)),e=document.querySelector("#view-cmts-cta-".concat(o));t&&t.classList.add("showComments"),e&&e.classList.add("hide");var i=t||n,s=function(){return i.scrollIntoView({behavior:"smooth",block:"center"})};s(),setTimeout(s,1e3)};i&&s(),e&&e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),s()}))}},x.prototype.openMobileModalIfNeeded=function(){var t=document.getElementById("spot-im-wafer-lightbox");if(t){var e=this.getIsOpenWebParam(),o=/(\?|&)a20_comeback_from_auth=1/gi.test(window.location.search);(e||o)&&t.click()}},x.prototype.updateUser=function(t){var e=this,o=this.pageContext.authed;if("1"===(void 0===o?"0":o)){this.debugLog("updateUser",t);var n=t.xhrPathPrefix,i=t.useStageToken,s=void 0!==i&&i,a=t.useCase,r=t.spotId,c=t.stageSpotId,d="".concat(n,"?m_id=spotIm&ctrl=SpotImSSO&m_mode=json");fetch(d,{body:JSON.stringify({action:"update",m_id:"spotIm",ctrl:"SpotImSSO",m_mode:"json",useStageToken:Boolean(s||this.isStaging),useCase:a,spotId:this.isStaging?c:r}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(t){if(200!==t.status)throw new Error("Request error")})).catch((function(t){e.debugLog("SpotIm updateUser fetch error",{error:t}),e.sendBeacon("spotIm-update-user-failure")}))}},x.prototype.debugLog=function(t,e){this.isDebug&&console.warn("[SpotIm-JAC-Debug]: ",t,e)},x.prototype.reportPerformance=function(t){var e=t.source,o=t.time,n=t.type;this.sendBeacon("spotIm-perf",{source:e,time:o,type:n})},x.prototype.reportError=function(t){var e=t.source,o=t.type;this.sendBeacon("spotIm-ow-error",{source:e,type:o})},x.prototype.checkCommentCount=function(t){var e=/[A-Za-z]$/.test(t);return(t&&parseFloat(t)||0)>=this.minCommentCountToSlotAds||e},x.prototype.addSpotImRightRailMarkup=function(t,e){var o=e.adPositions,n=void 0===o?"":o,i=e.commentsCount,s=void 0===i?"0":i,a=e.rightRailAdClasses,r=void 0===a?"":a,c=e.wfDarlaConfig,d=void 0===c?{}:c;if(this.checkCommentCount(s)){var l=n,m={adPositions:(l=l.split(";"))[0]||"COMMENTSLREC,COMMENTSMON",rightRailAdClasses:r,wfDarlaConfig:d},p=t.parentElement,u=t.cloneNode(!0),h=document.createElement("div");h.className="module-spotim-rr comments-block D(n)";var f=document.createElement("div");f.className="W(100%) D(f)";var v=document.createElement("main");v.className="spotim-main-section W($mainColWidth) Mend(20px)",v.appendChild(u);var g=document.createElement("aside");g.className="spotim-aside-section W(300px) D(f) Fld(c)";var w=document.createElement("div");w.className="spotim-non-sticky-sda";var _=this.getDarlaMarkup(m,this.RRFirstAdSlotPosCount++);w.appendChild(_),g.appendChild(w);var S=document.createElement("div");S.className="spotim-sticky-sda-wrapper Fxg(1) wafer wafer-sticky",S.setAttribute("data-wf-sticky-boundary","spotim-aside-section"),S.setAttribute("data-wf-sticky-offset","165px   10px"),S.setAttribute("data-wf-sticky-target",".spotim-sticky-sda");var C=document.createElement("div");C.className="spotim-sticky-sda",S.appendChild(C),g.appendChild(S),f.appendChild(v),f.appendChild(g),h.appendChild(f),p.replaceChild(h,t)}},x.prototype.getDarlaMarkup=function(t,e){var o=t.adPositions,n=void 0===o?"":o,i=t.rightRailAdClasses,s=void 0===i?"":i,a=t.wfDarlaConfig,r=void 0===a?{}:a,c=r.offsetX,d=r.offsetY,l=Object.assign({},r),m=n.split(",");l.meta={},l.pos=m.reduce((function(t,o){var n=e?"".concat(o,"-").concat(e):o;return r.meta[o]&&(l.meta[n]=r.meta[o]),t?"".concat(t,",").concat(n):n}),"");var p=document.createElement("div");return p.className="".concat(s," wafer wafer-darla"),p.setAttribute("data-wf-margin","".concat(d," ").concat(c)),p.setAttribute("data-wf-trigger","viewport"),p.setAttribute("data-wf-darla-config","".concat(JSON.stringify(l))),m.forEach((function(t){var o=e?"".concat(t,"-").concat(e):t,n=document.createElement("div");n.setAttribute("id","wafer-darla-clean-".concat(o));var i=document.createElement("div");i.setAttribute("id","wafer-darla-".concat(o)),n.appendChild(i),p.appendChild(n)})),p},x.prototype.initRightRailAds=function(t){var e=document.querySelector("#view-cmts-container-".concat(t," .spotim-non-sticky-sda .da-spotim"));if(e){e.style.marginBottom="500px";var o=document.querySelector("#view-cmts-container-".concat(t," .spotim-non-sticky-sda"));window.wafer.base.sync(o),o.classList.add("da-spotim-active")}},x.prototype.loadRightRailAdSlot=function(t){var e=this,o=t.adPositions,n=void 0===o?"":o,i=t.rightRailAdClasses,s=void 0===i?"":i,a=t.uuid,r=void 0===a?"":a,c=t.wfDarlaConfig,d=void 0===c?{}:c,l=document.querySelector("#view-cmts-container-".concat(r," .spotim-sticky-sda"));if(!l||!l.classList.contains("da-spotim-active")){var m=function(t,e){var o="";if(t>605)o=e;else if(t>305){o=e.split(",")[0]}return o},p=n.split(";"),u=p[1]||"COMMENTSLREC2,COMMENTSMON2",h=p[2]||"COMMENTSLREC3,COMMENTSMON3";setTimeout((function(){var t=document.querySelector("#view-cmts-container-".concat(r," .spotim-sticky-sda-wrapper")),o=null==t?void 0:t.offsetHeight,n=m(o,u);if(n){var i=document.querySelector("#view-cmts-container-".concat(r," .spotim-non-sticky-sda.da-spotim-active")),a=e.getDarlaMarkup({adPositions:n,rightRailAdClasses:s,wfDarlaConfig:d},e.RRSecondAdSlotPosCount++);a.style.marginBottom="500px",i.appendChild(a),a&&window.wafer.base.sync(i);var c=document.querySelector("#view-cmts-container-".concat(r," .spotim-sticky-sda-wrapper")),p=null==c?void 0:c.offsetHeight,f=m(p,h);if(f){var v=e.getDarlaMarkup({adPositions:f,rightRailAdClasses:s,wfDarlaConfig:d},e.RRThirdAdSlotPosCount++);l.appendChild(v),v&&window.wafer.base.sync(l),l.classList.add("da-spotim-active")}}}),2e3)}},x}();function B(){var t=document.getElementById("spotim-config");return t&&window.wafer.utils.getConfigFromJSONScriptNode(t).config||window.wafer.base.state.spotIm}function F(t){new x(t)}"undefined"!=typeof process&&(window.__SpotImJAC=x),window.wafer&&window.wafer.ready((function(){var t=B();t?F(t):window.wafer.on("module:added",(function(t){if("spotIm-conversations"===t.meta.id){var e=B();(null==e?void 0:e.useCase)===L&&F(e)}}))}),window)}();
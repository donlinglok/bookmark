<!DOCTYPE html>
<!-- saved from url=(0064)https://blog.patricktriest.com/text-search-docker-elasticsearch/ -->
<html class="cye-disabled cye-nm gr__blog_patricktriest_com"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Building a Full-Text Search App Using Docker and Elasticsearch</title>
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="shortcut icon" href="https://cdn.patricktriest.com/blog/images/favicon/favicon-32.png">
<link href="./Building a Full-Text Search App Using Docker and Elasticsearch_files/css" rel="stylesheet">
<link href="./Building a Full-Text Search App Using Docker and Elasticsearch_files/icon" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="./Building a Full-Text Search App Using Docker and Elasticsearch_files/screen.css">
<meta name="description" content="Adding fast, flexible, and accurate full-text search to apps can be a challenge.  In this tutorial, we&#39;ll walk through setting up a full-text search application using Docker, Elasticsearch, Node.js, and 100 classic novels.">
<link rel="shortcut icon" href="https://blog.patricktriest.com/favicon.png" type="image/png">
<link rel="canonical" href="https://blog.patricktriest.com/text-search-docker-elasticsearch/">
<meta name="referrer" content="no-referrer-when-downgrade">
<link rel="amphtml" href="https://blog.patricktriest.com/text-search-docker-elasticsearch/amp/">
<meta property="og:site_name" content="Break | Better">
<meta property="og:type" content="article">
<meta property="og:title" content="Building a Full-Text Search App Using Docker and Elasticsearch">
<meta property="og:description" content="Adding fast, flexible full-text search to apps can be a challenge.  In this tutorial, we&#39;ll walk through setting up a full-text search application using Docker, Elasticsearch, and 100 classic novels.">
<meta property="og:url" content="http://blog.patricktriest.com/text-search-docker-elasticsearch/">
<meta property="og:image" content="https://blog-images.patricktriest.com/uploads/library.jpg">
<meta property="article:published_time" content="2018-01-25T18:00:00.000Z">
<meta property="article:modified_time" content="2018-02-16T00:42:05.000Z">
<meta property="article:tag" content="Guides">
<meta property="article:tag" content="Javascript">
<meta property="article:tag" content="Node.js">
<meta property="article:tag" content="Web Development">
<meta property="article:tag" content="Devops">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Building a Full-Text Search App Using Docker and Elasticsearch">
<meta name="twitter:description" content="Adding fast, flexible full-text search to apps can be a challenge.  In this tutorial, we&#39;ll walk through setting up a full-text search application using Docker, Elasticsearch, and 100 classic novels.">
<meta name="twitter:url" content="http://blog.patricktriest.com/text-search-docker-elasticsearch/">
<meta name="twitter:image" content="https://blog-images.patricktriest.com/uploads/library.jpg">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Patrick Triest">
<meta name="twitter:label2" content="Filed under">
<meta name="twitter:data2" content="Guides, Javascript, Node.js, Web Development, Devops">
<meta property="og:image:width" content="1920">
<meta property="og:image:height" content="729">
<script async="" src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/analytics.js"></script><script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Break | Better",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog-images.patricktriest.com/uploads/ic_home_white_24dp_2x.png",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Patrick Triest",
        "image": {
            "@type": "ImageObject",
            "url": "https://blog-images.patricktriest.com/uploads/me-1.jpg",
            "width": 512,
            "height": 512
        },
        "url": "http://blog.patricktriest.com/author/patrick/",
        "sameAs": [
            "https://github.com/triestpa"
        ]
    },
    "headline": "Building a Full-Text Search App Using Docker and Elasticsearch",
    "url": "http://blog.patricktriest.com/text-search-docker-elasticsearch/",
    "datePublished": "2018-01-25T18:00:00.000Z",
    "dateModified": "2018-02-16T00:42:05.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://blog-images.patricktriest.com/uploads/library.jpg",
        "width": 1920,
        "height": 729
    },
    "keywords": "Guides, Javascript, Node.js, Web Development, Devops",
    "description": "Adding fast, flexible full-text search to apps can be a challenge.  In this tutorial, we&#x27;ll walk through setting up a full-text search application using Docker, Elasticsearch, and 100 classic novels.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://blog.patricktriest.com/"
    }
}
    </script>
<script type="text/javascript" src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/ghost-sdk.min.js"></script><style id="nightModeStyle">
html.cye-enabled.cye-nm:not(*:-webkit-full-screen) body,
 html.cye-enabled.cye-nm:not(*:-webkit-full-screen) #cye-workaround-body {-webkit-filter:contrast(91%) brightness(84%) invert(1);}</style><style id="cyebody">html.cye-enabled.cye-lm body{background-color:#c9e5cc !important;border-color:rgb(50, 57, 51) !important;color:#000000  !important}</style><style id="cyediv">html.cye-enabled.cye-lm div{background-color:#c9e5cc !important;border-color:rgb(50, 57, 51) !important;color:#000000  !important}</style><style id="cyetable">html.cye-enabled.cye-lm th{background-color:#c9e5cc !important;border-color:rgb(50, 57, 51) !important;color:#000000  !important}html.cye-enabled.cye-lm td{background-color:#c9e5cc !important;border-color:rgb(50, 57, 51) !important;color:#000000  !important}</style><style id="cyetextInput">html.cye-enabled.cye-lm input[type=text]{background-color:#c9e5cc !important;border-color:rgb(50, 57, 51) !important;color:#000000  !important}html.cye-enabled.cye-lm textarea{background-color:#c9e5cc !important;border-color:rgb(50, 57, 51) !important;color:#000000  !important}</style><style id="cyeselect">html.cye-enabled.cye-lm select{background-color:#c9e5cc !important;border-color:rgb(50, 57, 51) !important;color:#000000  !important}</style><style id="cyeul">html.cye-enabled.cye-lm ul{background-color:#c9e5cc !important;border-color:rgb(50, 57, 51) !important;color:#000000  !important}</style><style id="cyeChangeByClick">html.cye-enabled.cye-lm .cye-lm-tag,html.cye-enabled.cye-lm.cye-lm-tag{background-color:#c9e5cc !important;border-color:rgb(50, 57, 51) !important;color:#000000  !important}</style>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "70bc1e47a7c1"
});
</script>
<meta name="generator" content="Ghost 1.20">
<link rel="alternate" type="application/rss+xml" title="Break | Better" href="https://blog.patricktriest.com/rss/">
<link href="./Building a Full-Text Search App Using Docker and Elasticsearch_files/prism.css" rel="stylesheet">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47695665-8', 'auto');
  ga('send', 'pageview');
</script>
<script src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/embed.js" data-timestamp="1553587987109"></script><style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.9974049bf7b0591e5d4f055cb67f3ee3.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.880980e048a2432334f13013030456ac.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.4180262f1aa52e0f0340aac9fc52a8d8.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"></head><div id="cyeBlackMaskLayer" style="background-color: rgb(19, 19, 19); position: fixed; width: 1980px; height: 1080px; z-index: -2147483648;"></div>
<body class="post-template tag-guides tag-javascript tag-nodejs tag-web-development tag-devops nav-closed" data-gr-c-s-loaded="true" style="">
<div class="nav">
<h3 class="nav-title">Menu</h3>
<a href="https://blog.patricktriest.com/text-search-docker-elasticsearch/#" class="nav-close">
<span class="hidden">Close</span>
</a>
<ul>
<li class="nav-home"><a href="https://blog.patricktriest.com/">Home</a></li>
<li class="nav-projects-guides"><a href="https://blog.patricktriest.com/tag/guides/">Projects &amp; Guides</a></li>
<li class="nav-web-development"><a href="https://blog.patricktriest.com/tag/web-development/">Web Development</a></li>
<li class="nav-nodejs"><a href="https://blog.patricktriest.com/tag/nodejs/">Node.js</a></li>
<li class="nav-data-science"><a href="https://blog.patricktriest.com/tag/data-science/">Data Science</a></li>
<li class="nav-machine-learning"><a href="https://blog.patricktriest.com/tag/machine-learning/">Machine Learning</a></li>
<li class="nav-internet-of-things"><a href="https://blog.patricktriest.com/tag/internet-of-things/">Internet Of Things</a></li>
<li class="nav-github"><a href="https://github.com/triestpa">Github</a></li>
<li class="nav-resume"><a href="https://cdn.patricktriest.com/docs/Patrick_Triest-Resume-Early-2018.pdf">Resume</a></li>
<li class="nav-contact"><a href="https://blog.patricktriest.com/contact/">Contact</a></li>
</ul>
<a class="subscribe-button" href="https://blog.patricktriest.com/subscribe/">Subscribe</a>
</div>
<span class="nav-cover"></span>
<div class="site-wrapper">
<header class="main-header post-head-img img-background post-head " style="background-image: linear-gradient(
      rgba(0, 0, 0, 0.7),
      rgba(0, 0, 0, 0.75)
    ), url(https://blog-images.patricktriest.com/uploads/library.jpg)">
<nav class="main-nav overlay clearfix">
<a class="blog-logo" href="https://blog.patricktriest.com/"><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/ic_home_white_24dp_2x.png" alt="Break | Better"></a>
 <a class="menu-button icon-menu" href="https://blog.patricktriest.com/text-search-docker-elasticsearch/#"><span class="word">Menu</span></a>
</nav>
<h1 class="post-img-title">Building a Full-Text Search App Using Docker and Elasticsearch</h1>
<section class="post-meta">
<a href="https://blog.patricktriest.com/tag/guides/">Guides</a>, <a href="https://blog.patricktriest.com/tag/javascript/">Javascript</a>, <a href="https://blog.patricktriest.com/tag/nodejs/">Node.js</a>, <a href="https://blog.patricktriest.com/tag/web-development/">Web Development</a>, <a href="https://blog.patricktriest.com/tag/devops/">Devops</a> | <time class="post-date" datetime="2018-01-25">25 January 2018</time>
</section>
</header>
<main class="content" role="main">
<article class="post tag-guides tag-javascript tag-nodejs tag-web-development tag-devops featured">
<section class="post-content">
<div class="kg-card-markdown"><p><em>How does Wikipedia sort though 5+ million articles to find the most relevant one for your research?</em></p>
<p><em>How does Facebook find the friend who you're looking for (and whose name you've misspelled), across a userbase of 2+ billion people?</em></p>
<p><em>How does Google search the entire internet for webpages relevant to your vague, typo-filled search query?</em></p>
<p>In this tutorial, we'll walk through setting up our own full-text search application (of an admittedly lesser complexity than the systems in the questions above). Our example app will provide a UI and API to search the complete texts of 100 literary classics such as <em>Peter Pan</em>, <em>Frankenstein</em>, and <em>Treasure Island</em>.</p>
<p>You can preview a completed version of the tutorial app here - <a href="https://search.patricktriest.com/">https://search.patricktriest.com</a></p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_4_0.png" alt="preview webapp"></p>
<p>The source code for the application is 100% open-source and can be found at the GitHub repository here - <a href="https://github.com/triestpa/guttenberg-search">https://github.com/triestpa/guttenberg-search</a></p>
<p>Adding fast, flexible full-text search to apps can be a challenge. Most mainstream databases, such as <a href="https://www.postgresql.org/">PostgreSQL</a> and <a href="https://www.mongodb.com/">MongoDB</a>, offer very basic text searching capabilities due to limitations on their existing query and index structures. In order to implement high quality full-text search, a separate datastore is often the best option. <a href="https://www.elastic.co/">Elasticsearch</a> is a leading open-source datastore that is optimized to perform incredibly flexible and fast full-text search.</p>
<p>We'll be using <a href="https://www.docker.com/">Docker</a> to setup our project environment and dependencies. Docker is a containerization engine used by the likes of <a href="https://www.uber.com/">Uber</a>, <a href="https://www.spotify.com/us/">Spotify</a>, <a href="https://www.adp.com/">ADP</a>, and <a href="https://www.paypal.com/us/home">Paypal</a>. A major advantage of building a containerized app is that the project setup is virtually the same on Windows, macOS, and Linux - which makes writing this tutorial quite a bit simpler for me. Don't worry if you've never used Docker, we'll go through the full project configuration further down.</p>
<p>We'll also be using <a href="https://nodejs.org/en/">Node.js</a> (with the <a href="http://koajs.com/">Koa</a> framework), and <a href="https://vuejs.org/">Vue.js</a> to build our search API and frontend web app respectively.</p>
<h2 id="1whatiselasticsearch">1 - What is Elasticsearch?</h2>
<p>Full-text search is a heavily requested feature in modern applications. Search can also be one of the most difficult features to implement competently - many popular websites have subpar search functionality that returns results slowly and has trouble finding non-exact matches. Often, this is due to limitations in the underlying database: most standard relational databases are limited to basic <code>CONTAINS</code> or <code>LIKE</code> SQL queries, which provide only the most basic string matching functionality.</p>
<p>We'd like our search app to be :</p>
<ol>
<li><strong>Fast</strong> - Search results should be returned almost instantly, in order to provide a responsive user experience.</li>
<li><strong>Flexible</strong> - We'll want to be able to modify how the search is performed, in order to optimize for different datasets and use cases.</li>
<li><strong>Forgiving</strong> - If a search contains a typo, we'd still like to return relevant results for what the user might have been trying to search for.</li>
<li><strong>Full-Text</strong> - We don't want to limit our search to specific matching keywords or tags - we want to search <em>everything</em> in our datastore (including large text fields) for a match.</li>
</ol>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/Elasticsearch-Logo.png" alt="Elastic Search Logo"></p>
<p>In order to build a super-powered search feature, it’s often most ideal to use a datastore that is optimized for the task of full-text search. This is where <a href="https://www.elastic.co/">Elasticsearch</a> comes into play; Elasticsearch is an open-source in-memory datastore written in Java and originally built on the <a href="https://lucene.apache.org/core/">Apache Lucene</a> library.</p>
<p>Here are some examples of real-world Elasticsearch use cases from the official <a href="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/getting-started.html">Elastic website</a>.</p>
<ul>
<li>Wikipedia uses Elasticsearch to provide full-text search with highlighted search snippets, and search-as-you-type and did-you-mean suggestions.</li>
<li>The Guardian uses Elasticsearch to combine visitor logs with social -network data to provide real-time feedback to its editors about the public’s response to new articles.</li>
<li>Stack Overflow combines full-text search with geolocation queries and uses more-like-this to find related questions and answers.</li>
<li>GitHub uses Elasticsearch to query 130 billion lines of code.</li>
</ul>
<h3 id="whatmakeselasticsearchdifferentfromanormaldatabase">What makes Elasticsearch different from a "normal" database?</h3>
<p>At its core, Elasticsearch is able to provide fast and flexible full-text search through the use of <em>inverted indices</em>.</p>
<p>An "index" is a data structure to allow for ultra-fast data query and retrieval operations in databases. Databases generally index entries by storing an association of fields with the matching table rows. By storing the index in a searchable data structure (often a <a href="https://en.wikipedia.org/wiki/B-tree">B-Tree</a>), databases can achieve sub-linear time on optimized queries (such as “Find the row with ID = 5”).</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/db_index.png" alt="Relational Index"></p>
<p>We can think of a database index like an old-school library card catalog - it tells you precisely where the entry that you're searching for is located, as long as you already know the title and author of the book. Database tables generally have multiple indices in order to speed up queries on specific fields (i.e. an index on the <code>name</code> column would greatly speed up queries for rows with a specific name).</p>
<p>Inverted indexes work in a substantially different manner. The content of each row (or document) is split up, and each individual entry (in this case each word) points back to any documents that it was found within.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/invertedIndex.jpg" alt="Inverted Index"></p>
<p>This inverted-index data structure allows us to very quickly find, say, all of the documents where “football” was mentioned. Through the use of a heavily optimized in-memory inverted index, Elasticsearch enables us to perform some very powerful and customizable full-text searches on our stored data.</p>
<h2 id="2projectsetup">2 - Project Setup</h2>
<h3 id="20docker">2.0 - Docker</h3>
<p>We'll be using <a href="https://www.docker.com/">Docker</a> to manage the environments and dependencies for this project. Docker is a containerization engine that allows applications to be run in isolated environments, unaffected by the host operating system and local development environment. Many web-scale companies run a majority of their server infrastructure in containers now, due to the increased flexibility and composability of containerized application components.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/docker.png" alt="Docker Logo"></p>
<p>The advantage of using Docker for me, as the friendly author of this tutorial, is that the local environment setup is minimal and consistent across Windows, macOS, and Linux systems. Instead of going through divergent installation instructions for Node.js, Elasticsearch, and Nginx, we can instead just define these dependencies in Docker configuration files, and then run our app anywhere using this configuration. Furthermore, since each application component will run in it's own isolated container, there is much less potential for existing junk on our local machines to interfere, so "But it works on my machine!" types of scenarios will be much more rare when debugging issues.</p>
<h3 id="21installdockerdockercompose">2.1 - Install Docker &amp; Docker-Compose</h3>
<p>The only dependencies for this project are <a href="https://www.docker.com/">Docker</a> and <a href="https://docs.docker.com/compose/">docker-compose</a>, the later of which is an officially supported tool for defining multiple container configurations to <em>compose</em> into a single application stack.</p>
<p>Install Docker - <a href="https://docs.docker.com/engine/installation/">https://docs.docker.com/engine/installation/</a><br>
Install Docker Compose - <a href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p>
<h3 id="22setupprojectdirectories">2.2 - Setup Project Directories</h3>
<p>Create a base directory (say <code>guttenberg_search</code>) for the project. To organize our project we'll work within two main subdirectories.</p>
<ul>
<li><code>/public</code> - Store files for the frontend Vue.js webapp.</li>
<li><code>/server</code> - Server-side Node.js source code</li>
</ul>
<h3 id="23adddockercomposeconfig">2.3 - Add Docker-Compose Config</h3>
<p>Next, we'll create a <code>docker-compose.yml</code> file to define each container in our application stack.</p>
<ol>
<li><code>gs-api</code> - The Node.js container for the backend application logic.</li>
<li><code>gs-frontend</code> - An Ngnix container for serving the frontend webapp files.</li>
<li><code>gs-search</code> - An Elasticsearch container for storing and searching data.</li>
</ol>
<pre class=" language-yaml"><code class=" language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">api</span><span class="token punctuation">:</span> <span class="token comment"># Node.js App</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gs<span class="token punctuation">-</span>api
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> "3000<span class="token punctuation">:</span>3000" <span class="token comment"># Expose API port</span>
      <span class="token punctuation">-</span> "9229<span class="token punctuation">:</span>9229" <span class="token comment"># Expose Node process debug port (disable in production)</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span> <span class="token comment"># Set ENV vars</span>
     <span class="token punctuation">-</span> NODE_ENV=local
     <span class="token punctuation">-</span> ES_HOST=elasticsearch
     <span class="token punctuation">-</span> PORT=3000
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token comment"># Attach local book data directory</span>
      <span class="token punctuation">-</span> ./books<span class="token punctuation">:</span>/usr/src/app/books

  <span class="token key atrule">frontend</span><span class="token punctuation">:</span> <span class="token comment"># Nginx Server For Frontend App</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gs<span class="token punctuation">-</span>frontend
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token comment"># Serve local "public" dir</span>
      <span class="token punctuation">-</span> ./public<span class="token punctuation">:</span>/usr/share/nginx/html
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> "8080<span class="token punctuation">:</span>80" <span class="token comment"># Forward site to localhost:8080</span>

  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span> <span class="token comment"># Elasticsearch Instance</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gs<span class="token punctuation">-</span>search
    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/elasticsearch/elasticsearch<span class="token punctuation">:</span>6.1.1
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token comment"># Persist ES data in seperate "esdata" volume</span>
      <span class="token punctuation">-</span> esdata<span class="token punctuation">:</span>/usr/share/elasticsearch/data
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> bootstrap.memory_lock=true
      <span class="token punctuation">-</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span>
      <span class="token punctuation">-</span> discovery.type=single<span class="token punctuation">-</span>node
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token comment"># Expose Elasticsearch ports</span>
      <span class="token punctuation">-</span> <span class="token string">"9300:9300"</span>
      <span class="token punctuation">-</span> <span class="token string">"9200:9200"</span>

<span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token comment"># Define seperate volume for Elasticsearch data</span>
  <span class="token key atrule">esdata</span><span class="token punctuation">:</span>
</code></pre>
<br>
<p>This file defines our entire application stack - no need to install Elasticsearch, Node, or Nginx on your local system. Each container is forwarding ports to the host system (<code>localhost</code>), in order for us to access and debug the Node API, Elasticsearch instance, and fronted web app from our host machine.</p>
<h3 id="24adddockerfile">2.4 - Add Dockerfile</h3>
<p>We are using official prebuilt images for Nginx and Elasticsearch, but we'll need to build our own image for the Node.js app.</p>
<p>Define a simple <code>Dockerfile</code> configuration in the application root directory.</p>
<pre class=" language-docker"><code class=" language-docker"><span class="token comment"># Use Node v8.9.0 LTS</span>
<span class="token keyword">FROM</span> node<span class="token punctuation">:</span>carbon

<span class="token comment"># Setup app working directory</span>
<span class="token keyword">WORKDIR</span> /usr/src/app

<span class="token comment"># Copy package.json and package-lock.json</span>
<span class="token keyword">COPY</span> package*.json ./

<span class="token comment"># Install app dependencies</span>
<span class="token keyword">RUN</span> npm install

<span class="token comment"># Copy sourcecode</span>
<span class="token keyword">COPY</span> . .

<span class="token comment"># Start app</span>
<span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token string">"npm"</span><span class="token punctuation">,</span> <span class="token string">"start"</span> <span class="token punctuation">]</span>
</code></pre>
<br>
<p>This Docker configuration extends the official Node.js image, copies our application source code, and installs the NPM dependencies within the container.</p>
<p>We'll also add a <code>.dockerignore</code> file to avoid copying unneeded files into the container.</p>
<pre class=" language-text"><code class=" language-text">node_modules/
npm-debug.log
books/
public/
</code></pre>
<br>
<blockquote>
<p>Note that we're not copying the <code>node_modules</code> directory into our container - this is because we'll be running <code>npm install</code> from within the container build process. Attempting to copy the <code>node_modules</code> from the host system into a container can cause errors since some packages need to be specifically built for certain operating systems. For instance, installing the <code>bcrypt</code> package on macOS and attempting to copy that module directly to an Ubuntu container will not work because <code>bcyrpt</code> relies on a binary that needs to be built specifically for each operating system.</p>
</blockquote>
<h3 id="25addbasefiles">2.5 - Add Base Files</h3>
<p>In order to test out the configuration, we'll need to add some placeholder files to the app directories.</p>
<p>Add this base HTML file at <code>public/index.html</code></p>
<pre class=" language-html"><code class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>Hello World From The Frontend Container<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<br>
<p>Next, add the placeholder Node.js app file at <code>server/app.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Hello World From the Backend Container'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>PORT <span class="token operator">||</span> <span class="token number">3000</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`App Listening on Port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<br>
<p>Finally, add our <code>package.json</code> Node app configuration.</p>
<pre class=" language-json"><code class=" language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"guttenberg-search"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Source code for Elasticsearch tutorial using 100 classic open source books."</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node --inspect=0.0.0.0:9229 server/app.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"repository"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"git"</span><span class="token punctuation">,</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"git+https://github.com/triestpa/guttenberg-search.git"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"patrick.triest@gmail.com"</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>
  <span class="token property">"bugs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://github.com/triestpa/guttenberg-search/issues"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"homepage"</span><span class="token operator">:</span> <span class="token string">"https://github.com/triestpa/guttenberg-search#readme"</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"elasticsearch"</span><span class="token operator">:</span> <span class="token string">"13.3.1"</span><span class="token punctuation">,</span>
    <span class="token property">"joi"</span><span class="token operator">:</span> <span class="token string">"13.0.1"</span><span class="token punctuation">,</span>
    <span class="token property">"koa"</span><span class="token operator">:</span> <span class="token string">"2.4.1"</span><span class="token punctuation">,</span>
    <span class="token property">"koa-joi-validate"</span><span class="token operator">:</span> <span class="token string">"0.5.1"</span><span class="token punctuation">,</span>
    <span class="token property">"koa-router"</span><span class="token operator">:</span> <span class="token string">"7.2.1"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<p>This file defines the application start command and the Node.js package dependencies.</p>
<blockquote>
<p>Note - You don't have to run <code>npm install</code> - the dependencies will be installed inside the container when it is built.</p>
</blockquote>
<h3 id="26tryitout">2.6 - Try it Out</h3>
<p>Everything is in place now to test out each component of the app. From the base directory, run <code>docker-compose build</code>, which will build our Node.js application container.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_0_3.png" alt="docker build output"></p>
<p>Next, run <code>docker-compose up</code> to launch our entire application stack.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_0_2.png" alt="docker compose output"></p>
<blockquote>
<p>This step might take a few minutes since Docker has to download the base images for each container. In subsequent runs, starting the app should be nearly instantaneous, since the required images will have already been downloaded.</p>
</blockquote>
<p>Try visiting <code>localhost:8080</code> in your browser - you should see a simple "Hello World" webpage.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_0_0.png" alt="frontend sample output"></p>
<p>Visit <code>localhost:3000</code> to verify that our Node server returns it's own "Hello World" message.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_0_1.png" alt="backend sample output"></p>
<p>Finally, visit <code>localhost:9200</code> to check that Elasticsearch is running. It should return information similar to this.</p>
<pre class=" language-json"><code class=" language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"SLTcfpI"</span><span class="token punctuation">,</span>
  <span class="token property">"cluster_name"</span> <span class="token operator">:</span> <span class="token string">"docker-cluster"</span><span class="token punctuation">,</span>
  <span class="token property">"cluster_uuid"</span> <span class="token operator">:</span> <span class="token string">"iId8e0ZeS_mgh9ALlWQ7-w"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"number"</span> <span class="token operator">:</span> <span class="token string">"6.1.1"</span><span class="token punctuation">,</span>
    <span class="token property">"build_hash"</span> <span class="token operator">:</span> <span class="token string">"bd92e7f"</span><span class="token punctuation">,</span>
    <span class="token property">"build_date"</span> <span class="token operator">:</span> <span class="token string">"2017-12-17T20:23:25.338Z"</span><span class="token punctuation">,</span>
    <span class="token property">"build_snapshot"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"lucene_version"</span> <span class="token operator">:</span> <span class="token string">"7.1.0"</span><span class="token punctuation">,</span>
    <span class="token property">"minimum_wire_compatibility_version"</span> <span class="token operator">:</span> <span class="token string">"5.6.0"</span><span class="token punctuation">,</span>
    <span class="token property">"minimum_index_compatibility_version"</span> <span class="token operator">:</span> <span class="token string">"5.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"tagline"</span> <span class="token operator">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<p>If all three URLs display data successfully, congrats! The entire containerized stack is running, so now we can move on to the fun part.</p>
<h2 id="3connecttoelasticsearch">3 - Connect To Elasticsearch</h2>
<p>The first thing that we'll need to do in our app is connect to our local Elasticsearch instance.</p>
<h3 id="30addesconnectionmodule">3.0 - Add ES Connection Module</h3>
<p>Add the following Elasticsearch initialization code to a new file <code>server/connection.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">const</span> elasticsearch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'elasticsearch'</span><span class="token punctuation">)</span>

<span class="token comment">// Core ES variables for this project</span>
<span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token string">'library'</span>
<span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token string">'novel'</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">9200</span>
<span class="token keyword">const</span> host <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>ES_HOST <span class="token operator">||</span> <span class="token string">'localhost'</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">elasticsearch<span class="token punctuation">.</span>Client</span><span class="token punctuation">(</span><span class="token punctuation">{</span> host<span class="token punctuation">:</span> <span class="token punctuation">{</span> host<span class="token punctuation">,</span> port <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/** Check the ES connection status */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkConnection</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> isConnected <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>isConnected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Connecting to ES'</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> health <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span><span class="token function">health</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>health<span class="token punctuation">)</span>
      isConnected <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Connection Failed, Retrying...'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">checkConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<br>
<p>Let's rebuild our Node app now that we've made changes, using <code>docker-compose build</code>. Next, run <code>docker-compose up -d</code> to start the application stack as a background daemon process.</p>
<p>With the app started, run <code>docker exec gs-api "node" "server/connection.js"</code> on the command line in order to run our script within the container. You should see some system output similar to the following.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token punctuation">{</span> cluster_name<span class="token punctuation">:</span> <span class="token string">'docker-cluster'</span><span class="token punctuation">,</span>
  status<span class="token punctuation">:</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span>
  timed_out<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  number_of_nodes<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  number_of_data_nodes<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  active_primary_shards<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  active_shards<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  relocating_shards<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  initializing_shards<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  unassigned_shards<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  delayed_unassigned_shards<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  number_of_pending_tasks<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  number_of_in_flight_fetch<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  task_max_waiting_in_queue_millis<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  active_shards_percent_as_number<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token punctuation">}</span>
</code></pre>
<br>
<p>Go ahead and remove the <code>checkConnection()</code> call at the bottom before moving on, since in our final app we'll be making that call from outside the connection module.</p>
<h3 id="31addhelperfunctiontoresetindex">3.1 - Add Helper Function To Reset Index</h3>
<p>In <code>server/connection.js</code> add the following function below <code>checkConnection</code>, in order to provide an easy way to reset our Elasticsearch index.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment">/** Clear the index, recreate it, and add mappings */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">resetIndex</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> client<span class="token punctuation">.</span>indices<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> index <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> client<span class="token punctuation">.</span>indices<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">{</span> index <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> client<span class="token punctuation">.</span>indices<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> index <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">putBookMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<h3 id="32addbookschema">3.2 - Add Book Schema</h3>
<p>Next, we'll want to add a "mapping" for the book data schema. Add the following function below <code>resetIndex</code> in <code>server/connection.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment">/** Add book section schema mapping to ES */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">putBookMapping</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'keyword'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'keyword'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    location<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'integer'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> client<span class="token punctuation">.</span>indices<span class="token punctuation">.</span><span class="token function">putMapping</span><span class="token punctuation">(</span><span class="token punctuation">{</span> index<span class="token punctuation">,</span> type<span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token punctuation">{</span> properties<span class="token punctuation">:</span> schema <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<p>Here we are defining a mapping for the <code>book</code> index. An Elasticsearch <code>index</code> is roughly analogous to a SQL <code>table</code> or a MongoDB <code>collection</code>. Adding a mapping allows us to specify each field and datatype for the stored documents. Elasticsearch is schema-less, so we don't technically need to add a mapping, but doing so will give us more control over how the data is handled.</p>
<p>For instance - we're assigning the <code>keyword</code> type to the "title" and "author" fields, and the <code>text</code> type to the "text" field. Doing so will cause the search engine to treat these string fields differently - During a search, the engine will search <em>within</em> the <code>text</code> field for potential matches, whereas <code>keyword</code> fields will be matched based on their full content. This might seem like a minor distinction, but it can have a huge impact on the behavior and speed of different searches.</p>
<p>Export the exposed properties and functions at the bottom of the file, so that they can be accessed by other modules in our app.</p>
<pre class=" language-javascript"><code class=" language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">,</span> index<span class="token punctuation">,</span> type<span class="token punctuation">,</span> checkConnection<span class="token punctuation">,</span> resetIndex
<span class="token punctuation">}</span>
</code></pre>
<br>
<h2 id="4loadtherawdata">4 - Load The Raw Data</h2>
<p>We'll be using data from <a href="https://www.gutenberg.org/">Project Gutenberg</a> - an online effort dedicated to providing free, digital copies of books within the public domain. For this project, we'll be populating our library with 100 classic books, including texts such as <em>The Adventures of Sherlock Holmes</em>, <em>Treasure Island</em>, <em>The Count of Monte Cristo</em>, <em>Around the World in 80 Days</em>, <em>Romeo and Juliet</em>, and <em>The Odyssey</em>.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/books.jpg" alt="Book Covers"></p>
<h3 id="41downloadbookfiles">4.1 - Download Book Files</h3>
<p>I've zipped the 100 books into a file that you can download here -<br>
<a href="https://cdn.patricktriest.com/data/books.zip">https://cdn.patricktriest.com/data/books.zip</a></p>
<p>Extract this file into a <code>books/</code> directory in your project.</p>
<p>If you want, you can do this by using the following commands (requires <a href="https://www.gnu.org/software/wget/">wget</a> and <a href="https://theunarchiver.com/command-line">"The Unarchiver" CLI</a>).</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">wget</span> https://cdn.patricktriest.com/data/books.zip
unar books.zip
</code></pre>
<br>
<h3 id="42previewabook">4.2 - Preview A Book</h3>
<p>Try opening one of the book files, say <code>219-0.txt</code>. You'll notice that it starts with an open access license, followed by some lines identifying the book title, author, release dates, language and character encoding.</p>
<pre class=" language-txt"><code class=" language-txt">Title: Heart of Darkness

Author: Joseph Conrad

Release Date: February 1995 [EBook #219]
Last Updated: September 7, 2016

Language: English

Character set encoding: UTF-8
</code></pre>
<br>
<p>After these lines comes <code>*** START OF THIS PROJECT GUTENBERG EBOOK HEART OF DARKNESS ***</code>, after which the book content actually starts.</p>
<p>If you scroll to the end of the book you'll see the matching message <code>*** END OF THIS PROJECT GUTENBERG EBOOK HEART OF DARKNESS ***</code>, which is followed by a much more detailed version of the book's license.</p>
<p>In the next steps, we'll programmatically parse the book metadata from this header and extract the book content from between the <code>*** START OF</code> and <code>***END OF</code> place markers.</p>
<h3 id="43readdatadir">4.3 - Read Data Dir</h3>
<p>Let's write a script to read the content of each book and to add that data to Elasticsearch. We'll define a new Javascript file <code>server/load_data.js</code> in order to perform these operations.</p>
<p>First, we'll obtain a list of every file within the <code>books/</code> data directory.</p>
<p>Add the following content to <code>server/load_data.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> esConnection <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./connection'</span><span class="token punctuation">)</span>

<span class="token comment">/** Clear ES index, parse and index all files from the books directory */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">readAndInsertBooks</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Clear previous ES index</span>
    <span class="token keyword">await</span> esConnection<span class="token punctuation">.</span><span class="token function">resetIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Read books directory</span>
    <span class="token keyword">let</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token string">'./books'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>file <span class="token operator">=&gt;</span> file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'.txt'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Found </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>files<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> Files`</span></span><span class="token punctuation">)</span>

    <span class="token comment">// Read each book file, and index each paragraph in elasticsearch</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> file <span class="token keyword">of</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Reading File - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'./books'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> author<span class="token punctuation">,</span> paragraphs <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">parseBookFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
      <span class="token keyword">await</span> <span class="token function">insertBookData</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> author<span class="token punctuation">,</span> paragraphs<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">readAndInsertBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<br>
<p>We'll use a shortcut command to rebuild our Node.js app and update the running container.</p>
<p>Run <code>docker-compose up -d --build</code> to update the application. This is a shortcut for running <code>docker-compose build</code> and <code>docker-compose up -d</code>.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_1_0.png" alt="docker build output"></p>
<p>Run<code>docker exec gs-api "node" "server/load_data.js"</code> in order to run our <code>load_data</code> script within the container. You should see the Elasticsearch status output, followed by <code>Found 100 Books</code>.</p>
<p>After this, the script will exit due to an error because we're calling a helper function (<code>parseBookFile</code>) that we have not yet defined.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_1_1.png" alt="docker exec output"></p>
<h3 id="44readdatafile">4.4 - Read Data File</h3>
<p>Next, we'll read the metadata and content for each book.</p>
<p>Define a new function in <code>server/load_data.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment">/** Read an individual book text file, and extract the title, author, and paragraphs */</span>
<span class="token keyword">function</span> <span class="token function">parseBookFile</span> <span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Read text file</span>
  <span class="token keyword">const</span> book <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>

  <span class="token comment">// Find book title and author</span>
  <span class="token keyword">const</span> title <span class="token operator">=</span> book<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^Title:\s(.+)$/m</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> authorMatch <span class="token operator">=</span> book<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^Author:\s(.+)$/m</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> author <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>authorMatch <span class="token operator">||</span> authorMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'Unknown Author'</span> <span class="token punctuation">:</span> authorMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Reading Book - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> By </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>author<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>

  <span class="token comment">// Find Guttenberg metadata header and footer</span>
  <span class="token keyword">const</span> startOfBookMatch <span class="token operator">=</span> book<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^\*{3}\s*START OF (THIS|THE) PROJECT GUTENBERG EBOOK.+\*{3}$/m</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> startOfBookIndex <span class="token operator">=</span> startOfBookMatch<span class="token punctuation">.</span>index <span class="token operator">+</span> startOfBookMatch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length
  <span class="token keyword">const</span> endOfBookIndex <span class="token operator">=</span> book<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^\*{3}\s*END OF (THIS|THE) PROJECT GUTENBERG EBOOK.+\*{3}$/m</span><span class="token punctuation">)</span><span class="token punctuation">.</span>index

  <span class="token comment">// Clean book text and split into array of paragraphs</span>
  <span class="token keyword">const</span> paragraphs <span class="token operator">=</span> book
    <span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>startOfBookIndex<span class="token punctuation">,</span> endOfBookIndex<span class="token punctuation">)</span> <span class="token comment">// Remove Guttenberg header and footer</span>
    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\n\s+\n/g</span><span class="token punctuation">)</span> <span class="token comment">// Split each paragraph into it's own array entry</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>line <span class="token operator">=&gt;</span> line<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\r\n/g</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Remove paragraph line breaks and whitespace</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>line <span class="token operator">=&gt;</span> line<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/_/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Guttenberg uses "_" to signify italics.  We'll remove it, since it makes the raw text look messy.</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>line <span class="token operator">&amp;&amp;</span> line <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Remove empty lines</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Parsed </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>paragraphs<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> Paragraphs\n`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> author<span class="token punctuation">,</span> paragraphs <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<p>This function performs a few important tasks.</p>
<ol>
<li>Read book text from the file system.</li>
<li>Use regular expressions (check out <a href="https://blog.patricktriest.com/you-should-learn-regex/">this post</a> for a primer on using regex) to parse the book title and author.</li>
<li>Identify the start and end of the book content, by matching on the all-caps "Project Guttenberg" header and footer.</li>
<li>Extract the book text content.</li>
<li>Split each paragraph into its own array.</li>
<li>Clean up the text and remove blank lines.</li>
</ol>
<p>As a return value, we'll form an object containing the book's title, author, and an array of paragraphs within the book.</p>
<p>Run <code>docker-compose up -d --build</code> and <code>docker exec gs-api "node" "server/load_data.js"</code> again, and you should see the same output as before, this time with three extra lines at the end of the output.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_2_0.png" alt="docker exec output"><br>
<br></p>
<p>Success! Our script successfully parsed the title and author from the text file. The script will again end with an error since we still have to define one more helper function.</p>
<h3 id="45indexdatafileines">4.5 - Index Datafile in ES</h3>
<p>As a final step, we'll bulk-upload each array of paragraphs into the Elasticsearch index.</p>
<p>Add a new <code>insertBookData</code> function to <code>load_data.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment">/** Bulk index the book data in Elasticsearch */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">insertBookData</span> <span class="token punctuation">(</span>title<span class="token punctuation">,</span> author<span class="token punctuation">,</span> paragraphs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> bulkOps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// Array to store bulk operations</span>

  <span class="token comment">// Add an index operation for each section in the book</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paragraphs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Describe action</span>
    bulkOps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> index<span class="token punctuation">:</span> <span class="token punctuation">{</span> _index<span class="token punctuation">:</span> esConnection<span class="token punctuation">.</span>index<span class="token punctuation">,</span> _type<span class="token punctuation">:</span> esConnection<span class="token punctuation">.</span>type <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// Add document</span>
    bulkOps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      author<span class="token punctuation">,</span>
      title<span class="token punctuation">,</span>
      location<span class="token punctuation">:</span> i<span class="token punctuation">,</span>
      text<span class="token punctuation">:</span> paragraphs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> i <span class="token operator">%</span> <span class="token number">500</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Do bulk insert in 500 paragraph batches</span>
      <span class="token keyword">await</span> esConnection<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">bulk</span><span class="token punctuation">(</span><span class="token punctuation">{</span> body<span class="token punctuation">:</span> bulkOps <span class="token punctuation">}</span><span class="token punctuation">)</span>
      bulkOps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Indexed Paragraphs </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">-</span> <span class="token number">499</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Insert remainder of bulk ops array</span>
  <span class="token keyword">await</span> esConnection<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">bulk</span><span class="token punctuation">(</span><span class="token punctuation">{</span> body<span class="token punctuation">:</span> bulkOps <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Indexed Paragraphs </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>paragraphs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token punctuation">(</span>bulkOps<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>paragraphs<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n\n`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<p>This function will index each paragraph of the book, with author, title, and paragraph location metadata attached. We are inserting the paragraphs using a bulk operation, which is much faster than indexing each paragraph individually.</p>
<blockquote>
<p>We're bulk indexing the paragraphs in batches, instead of inserting all of them at once. This was a last minute optimization which I added in order for the app to run on the low-ish memory (1.7 GB) host machine that serves <code>search.patricktriest.com</code>. If you have a reasonable amount of RAM (4+ GB), you probably don't need to worry about batching each bulk upload,</p>
</blockquote>
<p>Run <code>docker-compose up -d --build</code> and <code>docker exec gs-api "node" "server/load_data.js"</code> one more time - you should now see a full output of 100 books being parsed and inserted in Elasticsearch. This might take a minute or so.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_3_0.png" alt="data loading output"></p>
<h2 id="5search">5 - Search</h2>
<p>Now that Elasticsearch has been populated with one hundred books (amounting to roughly 230,000 paragraphs), let's try out some search queries.</p>
<h3 id="50simplehttpquery">5.0 - Simple HTTP Query</h3>
<p>First, let's just query Elasticsearch directly using it's HTTP API.</p>
<p>Visit this URL in your browser - <code>http://localhost:9200/library/_search?q=text:Java&amp;pretty</code></p>
<p>Here, we are performing a bare-bones full-text search to find the word "Java" within our library of books.</p>
<p>You should see a JSON response similar to the following.</p>
<pre class=" language-json"><code class=" language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">14.259304</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"library"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"novel"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"p_GwFWEBaZvLlaAUdQgV"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">14.259304</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"author"</span> <span class="token operator">:</span> <span class="token string">"Charles Darwin"</span><span class="token punctuation">,</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"On the Origin of Species"</span><span class="token punctuation">,</span>
          <span class="token property">"location"</span> <span class="token operator">:</span> <span class="token number">1080</span><span class="token punctuation">,</span>
          <span class="token property">"text"</span> <span class="token operator">:</span> <span class="token string">"Java, plants of, 375."</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"library"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"novel"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"wfKwFWEBaZvLlaAUkjfk"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">10.186235</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"author"</span> <span class="token operator">:</span> <span class="token string">"Edgar Allan Poe"</span><span class="token punctuation">,</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"The Works of Edgar Allan Poe"</span><span class="token punctuation">,</span>
          <span class="token property">"location"</span> <span class="token operator">:</span> <span class="token number">827</span><span class="token punctuation">,</span>
          <span class="token property">"text"</span> <span class="token operator">:</span> <span class="token string">"After many years spent in foreign travel, I sailed in the year 18-- , from the port of Batavia, in the rich and populous island of Java, on a voyage to the Archipelago of the Sunda islands. I went as passenger--having no other inducement than a kind of nervous restlessness which haunted me as a fiend."</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      ...
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<p>The Elasticseach HTTP interface is useful for testing that our data is inserted successfully, but exposing this API directly to the web app would be a huge security risk. The API exposes administrative functionality (such as directly adding and deleting documents), and should ideally not ever be exposed publicly. Instead, we'll write a simple Node.js API to receive requests from the client, and make the appropriate query (within our private local network) to Elasticsearch.</p>
<h3 id="51queryscript">5.1 - Query Script</h3>
<p>Let's now try querying Elasticsearch from our Node.js application.</p>
<p>Create a new file, <code>server/search.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> client<span class="token punctuation">,</span> index<span class="token punctuation">,</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./connection'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Query ES index for the provided term */</span>
  <span class="token function">queryTerm</span> <span class="token punctuation">(</span>term<span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword">from</span><span class="token punctuation">:</span> offset<span class="token punctuation">,</span>
      query<span class="token punctuation">:</span> <span class="token punctuation">{</span> match<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        text<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          query<span class="token punctuation">:</span> term<span class="token punctuation">,</span>
          operator<span class="token punctuation">:</span> <span class="token string">'and'</span><span class="token punctuation">,</span>
          fuzziness<span class="token punctuation">:</span> <span class="token string">'auto'</span>
        <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      highlight<span class="token punctuation">:</span> <span class="token punctuation">{</span> fields<span class="token punctuation">:</span> <span class="token punctuation">{</span> text<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">{</span> index<span class="token punctuation">,</span> type<span class="token punctuation">,</span> body <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<p>Our search module defines a simple <code>search</code> function, which will perform a <code>match</code> query using the input term.</p>
<p>Here are query fields broken down -</p>
<ul>
<li><code>from</code> - Allows us to paginate the results. Each query returns 10 results by default, so specifying <code>from: 10</code> would allow us to retrieve results 10-20.</li>
<li><code>query</code> - Where we specify the actual term that we are searching for.</li>
<li><code>operator</code> - We can modify the search behavior; in this case, we're using the "and" operator to prioritize results that contain all of the tokens (words) in the query.</li>
<li><code>fuzziness</code> - Adjusts tolerance for spelling mistakes, <code>auto</code> defaults to <code>fuzziness: 2</code>. A higher fuzziness will allow for more corrections in result hits. For instance, <code>fuzziness: 1</code> would allow <code>Patricc</code> to return <code>Patrick</code> as a match.</li>
<li><code>highlights</code> - Returns an extra field with the result, containing HTML to display the exact text subset and terms that were matched with the query.</li>
</ul>
<p>Feel free to play around with these parameters, and to customize the search query further by exploring the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/full-text-queries.html">Elastic Full-Text Query DSL</a>.</p>
<h2 id="6api">6 - API</h2>
<p>Let's write a quick HTTP API in order to access our search functionality from a frontend app.</p>
<h3 id="60apiserver">6.0 - API Server</h3>
<p>Replace our existing <code>server/app.js</code> file with the following contents.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> joi <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'joi'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> validate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-joi-validate'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> search <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./search'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Log each request to the console</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> ms <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ms<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Log percolated errors to the console</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Server Error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Set permissive CORS header</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ADD ENDPOINTS HERE</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>PORT <span class="token operator">||</span> <span class="token number">3000</span>

app
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`App Listening on Port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<br>
<p>This code will import our server dependencies and set up simple logging and error handling for a <a href="http://koajs.com/">Koa.js</a> Node API server.</p>
<h3 id="61linkendpointwithqueries">6.1 - Link endpoint with queries</h3>
<p>Next, we'll add an endpoint to our server in order to expose our Elasticsearch query function.</p>
<p>Insert the following code below the <code>// ADD ENDPOINTS HERE</code> comment in <code>server/app.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment">/**
 * GET /search
 * Search for a term in the library
 */</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> term<span class="token punctuation">,</span> offset <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> search<span class="token punctuation">.</span><span class="token function">queryTerm</span><span class="token punctuation">(</span>term<span class="token punctuation">,</span> offset<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<br>
<p>Restart the app using <code>docker-compose up -d --build</code>. In your browser, try calling the search endpoint. For example, this request would search the entire library for passages mentioning "Java" - <code>http://localhost:3000/search?term=java</code></p>
<p>The result will look quite similar to the response from earlier when we called the Elasticsearch HTTP interface directly.</p>
<pre class=" language-json"><code class=" language-json"><span class="token punctuation">{</span>
    <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">242</span><span class="token punctuation">,</span>
    <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">93</span><span class="token punctuation">,</span>
        <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token number">13.356944</span><span class="token punctuation">,</span>
        <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"library"</span><span class="token punctuation">,</span>
            <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"novel"</span><span class="token punctuation">,</span>
            <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"eHYHJmEBpQg9B4622421"</span><span class="token punctuation">,</span>
            <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">13.356944</span><span class="token punctuation">,</span>
            <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Charles Darwin"</span><span class="token punctuation">,</span>
                <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"On the Origin of Species"</span><span class="token punctuation">,</span>
                <span class="token property">"location"</span><span class="token operator">:</span> <span class="token number">1080</span><span class="token punctuation">,</span>
                <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Java, plants of, 375."</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"highlight"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"text"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;em&gt;Java&lt;/em&gt;, plants of, 375."</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"library"</span><span class="token punctuation">,</span>
            <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"novel"</span><span class="token punctuation">,</span>
            <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"2HUHJmEBpQg9B462xdNg"</span><span class="token punctuation">,</span>
            <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">9.030668</span><span class="token punctuation">,</span>
            <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Unknown Author"</span><span class="token punctuation">,</span>
                <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"The King James Bible"</span><span class="token punctuation">,</span>
                <span class="token property">"location"</span><span class="token operator">:</span> <span class="token number">186</span><span class="token punctuation">,</span>
                <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"10:4 And the sons of Javan; Elishah, and Tarshish, Kittim, and Dodanim."</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"highlight"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"text"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"10:4 And the sons of &lt;em&gt;Javan&lt;/em&gt;; Elishah, and Tarshish, Kittim, and Dodanim."</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        ...
      <span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<h3 id="62inputvalidation">6.2 - Input validation</h3>
<p>This endpoint is still brittle - we are not doing any checks on the request parameters, so invalid or missing values would result in a server error.</p>
<p>We'll add some middleware to the endpoint in order to validate input parameters using <a href="https://github.com/hapijs/joi">Joi</a> and the <a href="https://github.com/triestpa/koa-joi-validate">Koa-Joi-Validate</a> library.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment">/**
 * GET /search
 * Search for a term in the library
 * Query Params -
 * term: string under 60 characters
 * offset: positive integer
 */</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span>
  <span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      term<span class="token punctuation">:</span> joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      offset<span class="token punctuation">:</span> joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> term<span class="token punctuation">,</span> offset <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> search<span class="token punctuation">.</span><span class="token function">queryTerm</span><span class="token punctuation">(</span>term<span class="token punctuation">,</span> offset<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<p>Now, if you restart the server and make a request with a missing term(<code>http://localhost:3000/search</code>), you will get back an HTTP 400 error with a relevant message, such as <code>Invalid URL Query - child "term" fails because ["term" is required]</code>.</p>
<p>To view live logs from the Node app, you can run <code>docker-compose logs -f api</code>.</p>
<h2 id="7frontendapplication">7 - Front-End Application</h2>
<p>Now that our <code>/search</code> endpoint is in place, let's wire up a simple web app to test out the API.</p>
<h3 id="70vuejsapp">7.0 - Vue.js App</h3>
<p>We'll be using Vue.js to coordinate our frontend.</p>
<p>Add a new file, <code>/public/app.js</code>, to hold our Vue.js application code.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token punctuation">:</span> <span class="token string">'#vue-instance'</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      baseUrl<span class="token punctuation">:</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">,</span> <span class="token comment">// API url</span>
      searchTerm<span class="token punctuation">:</span> <span class="token string">'Hello World'</span><span class="token punctuation">,</span> <span class="token comment">// Default search term</span>
      searchDebounce<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// Timeout for search bar debounce</span>
      searchResults<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Displayed search results</span>
      numHits<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// Total search results found</span>
      searchOffset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// Search result pagination offset</span>

      selectedParagraph<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// Selected paragraph object</span>
      bookOffset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// Offset for book paragraphs being displayed</span>
      paragraphs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// Paragraphs being displayed in book preview window</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>searchResults <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Search for default term</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/** Debounce search input by 100 ms */</span>
    <span class="token function">onSearchInput</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchDebounce<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>searchDebounce <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>searchOffset <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>searchResults <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/** Call API to search for inputted term */</span>
    <span class="token keyword">async</span> <span class="token function">search</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/search`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> params<span class="token punctuation">:</span> <span class="token punctuation">{</span> term<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>searchTerm<span class="token punctuation">,</span> offset<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>searchOffset <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>numHits <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hits<span class="token punctuation">.</span>total
      <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hits<span class="token punctuation">.</span>hits
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/** Get next page of search results */</span>
    <span class="token keyword">async</span> <span class="token function">nextResultsPage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>numHits <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>searchOffset <span class="token operator">+=</span> <span class="token number">10</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchOffset <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numHits<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>searchOffset <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numHits <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>searchResults <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/** Get previous page of search results */</span>
    <span class="token keyword">async</span> <span class="token function">prevResultsPage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>searchOffset <span class="token operator">-=</span> <span class="token number">10</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchOffset <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>searchOffset <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>searchResults <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<br>
<p>The app is pretty simple - we're just defining some shared data properties, and adding methods to retrieve and paginate through search results. The search input is debounced by 100ms, to prevent the API from being called with every keystroke.</p>
<p>Explaining how Vue.js works is outside the scope of this tutorial, but this probably won't look too crazy if you've used Angular or React. If you're completely unfamiliar with Vue, and if you want something quick to get started with, I would recommend the official quick-start guide - <a href="https://vuejs.org/v2/guide/">https://vuejs.org/v2/guide/</a></p>
<h3 id="71html">7.1 - HTML</h3>
<p>Replace our placeholder <code>/public/index.html</code> file with the following contents, in order to load our Vue.js app and to layout a basic search interface.</p>
<pre class=" language-html"><code class=" language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Elastic Library<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Literary Classic Search Engine.<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.muicss.com/mui-0.9.20/css/mui.min.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com/css?family=EB+Garamond:400,700|Open+Sans<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>styles.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app-container<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vue-instance<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Search Bar Header --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-panel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-textfield<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>searchTerm<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onSearchInput()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>Search<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Search Metadata Card --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-panel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-headline<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ numHits }} Hits<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-subhead<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Displaying Results {{ searchOffset }} - {{ searchOffset + 9 }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Top Pagination Card --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-panel pagination-panel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-btn mui-btn--flat<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prevResultsPage()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Prev Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-btn mui-btn--flat<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nextResultsPage()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Next Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Search Results Card List --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search-results<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>searchResults<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-panel<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hit in searchResults<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showBookModal(hit)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-title<span class="token punctuation">"</span></span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hit.highlight.text[0]<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-divider<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-subhead<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ hit._source.title }} - {{ hit._source.author }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-body2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Location {{ hit._source.location }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Bottom Pagination Card --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-panel pagination-panel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-btn mui-btn--flat<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prevResultsPage()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Prev Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-btn mui-btn--flat<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nextResultsPage()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Next Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- INSERT BOOK MODAL HERE --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.muicss.com/mui-0.9.28/js/mui.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.3/vue.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/axios/0.17.0/axios.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<br>
<h3 id="72css">7.2 - CSS</h3>
<p>Add a new file, <code>/public/styles.css</code>, with some custom UI styling.</p>
<pre class=" language-css"><code class=" language-css"><span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'EB Garamond'</span>, serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">.mui-textfield &gt; input, .mui-btn, .mui--text-subhead, .mui-panel &gt; .mui--text-headline</span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Open Sans'</span>, sans-serif<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.all-caps</span> <span class="token punctuation">{</span> <span class="token property">text-transform</span><span class="token punctuation">:</span> uppercase<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.app-container</span> <span class="token punctuation">{</span> <span class="token property">padding</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.search-results em</span> <span class="token punctuation">{</span> <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.book-modal &gt; button</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.search-results .mui-divider</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> 14px 0<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">.search-results</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">flex-direction</span><span class="token punctuation">:</span> row<span class="token punctuation">;</span>
  <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-around<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.search-results &gt; div</span> <span class="token punctuation">{</span>
  <span class="token property">flex-basis</span><span class="token punctuation">:</span> 45%<span class="token punctuation">;</span>
  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector">.search-results &gt; div</span> <span class="token punctuation">{</span> <span class="token property">flex-basis</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token selector">.paragraphs-container</span> <span class="token punctuation">{</span>
  <span class="token property">max-width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.paragraphs-container .mui--text-body1, .paragraphs-container .mui--text-body2</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 1.8rem<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 35px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.book-modal</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 40px 10%<span class="token punctuation">;</span>
  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.pagination-panel</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.title-row</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> flex-end<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector">.title-row</span><span class="token punctuation">{</span> 
    <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span> 
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">align-items</span><span class="token punctuation">:</span> center
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token selector">.locations-label</span> <span class="token punctuation">{</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.modal-footer</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-around<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<h3 id="73tryitout">7.3 - Try it out</h3>
<p>Open <code>localhost:8080</code> in your web browser, you should see a simple search interface with paginated results. Try typing in the top search bar to find matches from different terms.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_4_0.png" alt="preview webapp"></p>
<blockquote>
<p>You <em>do not</em> have to re-run the <code>docker-compose up</code> command for the changes to take effect. The local <code>public</code> directory is mounted to our Nginx fileserver container, so frontend changes on the local system will be automatically reflected in the containerized app.</p>
</blockquote>
<p>If you try clicking on any result, nothing happens - we still have one more feature to add to the app.</p>
<h2 id="8pagepreviews">8 - Page Previews</h2>
<p>It would be nice to be able to click on each search result and view it in the context of the book that it's from.</p>
<h3 id="80addelasticsearchquery">8.0 - Add Elasticsearch Query</h3>
<p>First, we'll need to define a simple query to get a range of paragraphs from a given book.</p>
<p>Add the following function to the <code>module.exports</code> block in <code>server/search.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment">/** Get the specified range of paragraphs from a book */</span>
<span class="token function">getParagraphs</span> <span class="token punctuation">(</span>bookTitle<span class="token punctuation">,</span> startLocation<span class="token punctuation">,</span> endLocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> term<span class="token punctuation">:</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> bookTitle <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> range<span class="token punctuation">:</span> <span class="token punctuation">{</span> location<span class="token punctuation">:</span> <span class="token punctuation">{</span> gte<span class="token punctuation">:</span> startLocation<span class="token punctuation">,</span> lte<span class="token punctuation">:</span> endLocation <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>

  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token punctuation">{</span>
    size<span class="token punctuation">:</span> endLocation <span class="token operator">-</span> startLocation<span class="token punctuation">,</span>
    sort<span class="token punctuation">:</span> <span class="token punctuation">{</span> location<span class="token punctuation">:</span> <span class="token string">'asc'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    query<span class="token punctuation">:</span> <span class="token punctuation">{</span> bool<span class="token punctuation">:</span> <span class="token punctuation">{</span> filter <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">{</span> index<span class="token punctuation">,</span> type<span class="token punctuation">,</span> body <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<br>
<p>This new function will return an ordered array of paragraphs between the start and end locations of a given book.</p>
<h3 id="81addapiendpoint">8.1 - Add API Endpoint</h3>
<p>Now, let's link this function to an API endpoint.</p>
<p>Add the following to <code>server/app.js</code>, below the original <code>/search</code> endpoint.</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment">/**
 * GET /paragraphs
 * Get a range of paragraphs from the specified book
 * Query Params -
 * bookTitle: string under 256 characters
 * start: positive integer
 * end: positive integer greater than start
 */</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/paragraphs'</span><span class="token punctuation">,</span>
  <span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      bookTitle<span class="token punctuation">:</span> joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      start<span class="token punctuation">:</span> joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      end<span class="token punctuation">:</span> joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">greater</span><span class="token punctuation">(</span>joi<span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> bookTitle<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> search<span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span>bookTitle<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<br>
<h3 id="82adduifunctionality">8.2 - Add UI functionality</h3>
<p>Now that our new endpoint is in place, let's add some frontend functionality to query and display full pages from the book.</p>
<p>Add the following functions to the <code>methods</code> block of <code>/public/app.js</code>.</p>
<pre class=" language-javascript"><code class=" language-javascript">    <span class="token comment">/** Call the API to get current page of paragraphs */</span>
    <span class="token keyword">async</span> <span class="token function">getParagraphs</span> <span class="token punctuation">(</span>bookTitle<span class="token punctuation">,</span> offset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bookOffset <span class="token operator">=</span> offset
        <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bookOffset
        <span class="token keyword">const</span> end <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bookOffset <span class="token operator">+</span> <span class="token number">10</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/paragraphs`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> params<span class="token punctuation">:</span> <span class="token punctuation">{</span> bookTitle<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hits<span class="token punctuation">.</span>hits
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/** Get next page (next 10 paragraphs) of selected book */</span>
    <span class="token keyword">async</span> <span class="token function">nextBookPage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>bookModal<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>paragraphs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectedParagraph<span class="token punctuation">.</span>_source<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bookOffset <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/** Get previous page (previous 10 paragraphs) of selected book */</span>
    <span class="token keyword">async</span> <span class="token function">prevBookPage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>bookModal<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>paragraphs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectedParagraph<span class="token punctuation">.</span>_source<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bookOffset <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/** Display paragraphs from selected book in modal window */</span>
    <span class="token keyword">async</span> <span class="token function">showBookModal</span> <span class="token punctuation">(</span>searchHit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'hidden'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selectedParagraph <span class="token operator">=</span> searchHit
        <span class="token keyword">this</span><span class="token punctuation">.</span>paragraphs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span>searchHit<span class="token punctuation">.</span>_source<span class="token punctuation">.</span>title<span class="token punctuation">,</span> searchHit<span class="token punctuation">.</span>_source<span class="token punctuation">.</span>location <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/** Close the book detail modal */</span>
    <span class="token function">closeBookModal</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'auto'</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>selectedParagraph <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
</code></pre>
<br>
<p>These five functions provide the logic for downloading and paginating through pages (ten paragraphs each) in a book.</p>
<p>Now we just need to add a UI to display the book pages. Add this markup below the <code>&lt;!-- INSERT BOOK MODAL HERE --&gt;</code> comment in <code>/public/index.html</code>.</p>
<pre class=" language-html"><code class=" language-html">    <span class="token comment">&lt;!-- Book Paragraphs Modal Window --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectedParagraph<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bookModal<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>book-modal<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paragraphs-container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Book Section Metadata --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title-row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-display2 all-caps<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ selectedParagraph._source.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-display1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ selectedParagraph._source.author }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-divider<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-subhead locations-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Locations {{ bookOffset - 5 }} to {{ bookOffset + 5 }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-divider<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- Book Paragraphs --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paragraph in paragraphs<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>paragraph._source.location === selectedParagraph._source.location<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-body2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>{{ paragraph._source.text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui--text-body1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            {{ paragraph._source.text }}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

      <span class="token comment">&lt;!-- Book Pagination Footer --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modal-footer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-btn mui-btn--flat<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prevBookPage()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Prev Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-btn mui-btn--flat<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>closeBookModal()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Close<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mui-btn mui-btn--flat<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nextBookPage()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Next Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<br>
<p>Restart the app server (<code>docker-compose up -d --build</code>) again and open up <code>localhost:8080</code>. When you click on a search result, you are now able to view the surrounding paragraphs. You can now even read the rest of the book to completion if you're entertained by what you find.</p>
<p><img src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/sample_5_0.png" alt="preview webapp book page"></p>
<p>Congrats, you've completed the tutorial application!</p>
<p>Feel free to compare your local result against the completed sample hosted here - <a href="https://search.patricktriest.com/">https://search.patricktriest.com/</a></p>
<h2 id="9disadvantagesofelasticsearch">9 - Disadvantages of Elasticsearch</h2>
<h3 id="90resourcehog">9.0 - Resource Hog</h3>
<p>Elasticsearch is computationally demanding. The <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/hardware.html">official recommendation</a> is to run ES on a machine with 64 GB of RAM, and they strongly discourage running it on anything with under 8 GB of RAM. Elasticsearch is an <em>in-memory</em> datastore, which allows it to return results extremely quickly, but also results in a very significant system memory footprint. In production, <a href="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/distributed-cluster.html">it is strongly recommended to run multiple Elasticsearch nodes in a cluster</a> to allow for high server availability, automatic sharding, and data redundancy in case of a node failure.</p>
<p>I've got our tutorial application running on a $15/month GCP compute instance (at <a href="https://search.patricktriest.com/">search.patricktriest.com</a>) with 1.7 GB of RAM, and it <em>just barely</em> is able to run the Elasticsearch node; sometimes the entire machine freezes up during the initial data-loading step. Elasticsearch is, in my experience, much more of a resource hog than more traditional databases such as PostgreSQL and MongoDB, and can be significantly more expensive to host as a result.</p>
<h3 id="91syncingwithdatabases">9.1 - Syncing with Databases</h3>
<p>In most applications, storing all of the data in Elasticsearch is not an ideal option. It is possible to use ES as the primary transactional database for an app, but this is generally not recommended due to the lack of ACID compliance in Elasticsearch, which can lead to lost write operations when ingesting data at scale. In many cases, ES serves a more specialized role, such as powering the text searching features of the app. This specialized use requires that some of the data from the primary database is replicated to the Elasticsearch instance.</p>
<p>For instance, let's imagine that we're storing our users in a PostgreSQL table, but using Elasticsearch to power our user-search functionality. If a user, "Albert", decides to change his name to "Al", we'll need this change to be reflected in both our primary PostgreSQL database and in our auxiliary Elasticsearch cluster.</p>
<p>This can be a tricky integration to get right, and the best answer will depend on your existing stack. There are a multitude of open-source options available, from <a href="https://github.com/mongodb-labs/mongo-connector">a process to watch a MongoDB operation log</a> and automatically sync detected changes to ES, to a <a href="https://github.com/zombodb/zombodb">PostgresSQL plugin</a> to create a custom PSQL-based index that communicates automatically with Elasticsearch.</p>
<p>If none of the available pre-built options work, you could always just add some hooks into your server code to update the Elasticsearch index manually based on database changes. I would consider this final option to be a last resort, since keeping ES in sync using custom business logic can be complex, and is likely to introduce numerous bugs to the application.</p>
<p>The need to sync Elasticsearch with a primary database is more of an architectural complexity than it is a specific weakness of ES, but it's certainly worth keeping in mind when considering the tradeoffs of adding a dedicated search engine to your app.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Full-text search is one of the most important features in many modern applications - and is one of the most difficult to implement well. Elasticsearch is a fantastic option for adding fast and customizable text search to your application, but there are alternatives. <a href="https://lucene.apache.org/solr/">Apache Solr</a> is a similar open source search platform that is built on Apache Lucene - the same library at the core of Elasticsearch. <a href="https://www.algolia.com/">Algolia</a> is a search-as-a-service web platform which is growing quickly in popularity and is likely to be easier to get started with for beginners (but as a tradeoff is less customizable and can get quite expensive).</p>
<p>"Search-bar" style features are far from the only use-case for Elasticsearch. ES is also a very common tool for log storage and analysis, commonly used in an ELK (Elasticsearch, Logstash, Kibana) stack configuration. The flexible full-text search allowed by Elasticsearch can also be very useful for a wide variety of data science tasks - such as correcting/standardizing the spellings of entities within a dataset or searching a large text dataset for similar phrases.</p>
<p>Here are some ideas for your own projects.</p>
<ul>
<li>Add more of your favorite books to our tutorial app and create your own private library search engine.</li>
<li>Create an academic plagiarism detection engine by indexing papers from <a href="https://scholar.google.com/">Google Scholar</a>.</li>
<li>Build a spell checking application by indexing every word in the dictionary to Elasticsearch.</li>
<li>Build your own Google-competitor internet search engine by loading the <a href="https://aws.amazon.com/public-datasets/common-crawl/">Common Crawl Corpus</a> into Elasticsearch (caution - with over 5 billion pages, this can be a very expensive dataset play with).</li>
<li>Use Elasticsearch for journalism: search for specific names and terms in recent large-scale document leaks such as the <a href="https://en.wikipedia.org/wiki/Panama_Papers">Panama Papers</a> and <a href="https://en.wikipedia.org/wiki/Paradise_Papers">Paradise Papers</a>.</li>
</ul>
<p>The source code for this tutorial application is 100% open-source and can be found at the GitHub repository here - <a href="https://github.com/triestpa/guttenberg-search">https://github.com/triestpa/guttenberg-search</a></p>
<p>I hope you enjoyed the tutorial! Please feel free to post any thoughts, questions, or criticisms in the comments below.</p>
</div>
</section>
<footer class="post-footer">
<figure class="author-image">
<a class="img" href="https://blog.patricktriest.com/author/patrick/" style="background-image: url(https://blog-images.patricktriest.com/uploads/me-1.jpg)"><span class="hidden">Patrick Triest's Picture</span></a>
</figure>
<section class="author">
<h4><a href="https://blog.patricktriest.com/author/patrick/">Patrick Triest</a></h4>
<p>Full-stack engineer, data enthusiast, insatiable learner, obsessive builder. You can find me wandering on a mountain trail, pretending not to be lost. Software Engineer @ Google NYC.</p>
<div class="author-meta">
<span class="author-link icon-link"><a href="https://github.com/triestpa">https://github.com/triestpa</a></span>
</div>
</section>
<section class="share">
<h4>Share this post</h4>
<a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Building%20a%20Full-Text%20Search%20App%20Using%20Docker%20and%20Elasticsearch&amp;url=http://blog.patricktriest.com/text-search-docker-elasticsearch/" onclick="window.open(this.href, &#39;twitter-share&#39;, &#39;width=550,height=235&#39;);return false;">
<span class="hidden">Twitter</span>
</a>
<a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.patricktriest.com/text-search-docker-elasticsearch/" onclick="window.open(this.href, &#39;facebook-share&#39;,&#39;width=580,height=296&#39;);return false;">
<span class="hidden">Facebook</span>
</a>
<a class="icon-google-plus" href="https://plus.google.com/share?url=http://blog.patricktriest.com/text-search-docker-elasticsearch/" onclick="window.open(this.href, &#39;google-plus-share&#39;, &#39;width=490,height=530&#39;);return false;">
<span class="hidden">Google+</span>
</a>
</section>
<section class="gh-subscribe">
<h3 class="gh-subscribe-title">Subscribe to Break | Better</h3>
<p>Get the latest posts delivered right to your inbox.</p>
<form method="post" action="https://blog.patricktriest.com/subscribe/" class="">
<input class="confirm" type="hidden" name="confirm"><input class="location" type="hidden" name="location" value="https://blog.patricktriest.com/text-search-docker-elasticsearch/"><input class="referrer" type="hidden" name="referrer" value="">
<div class="form-group">
<input class="subscribe-email" type="email" name="email" placeholder="Your email address">
</div>
<button class="" type="submit"><span>Subscribe</span></button>
<script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>
<span class="gh-subscribe-rss">or subscribe <a href="https://blog.patricktriest.com/rss">via RSS</a></span>
</section>
</footer>
<div class="article-escape-full-width" style="margin-top:24px; margin-bottom:12px;">
<section class="featured-posts">
<div class="featured-posts-scroll">
<a class="read-next-story featured-post" style="background-image: url(https://cdn.patricktriest.com/blog/images/posts/policing-data/police_header.jpg)" href="https://blog.patricktriest.com/police-data-python/">
<section class="featured-post-content">
<h2>Exploring United States Policing Data Using Python</h2>
</section>
</a>
<a class="read-next-story featured-post" style="background-image: url(https://blog-images.patricktriest.com/uploads/painted_table.jpg)" href="https://blog.patricktriest.com/game-of-thrones-map-node-postgres-redis/">
<section class="featured-post-content">
<h2>Build An Interactive Game of Thrones Map (Part I) - Node.js, PostGIS, and Redis</h2>
</section>
</a>
<a class="read-next-story featured-post" style="background-image: url(https://cdn.patricktriest.com/blog/images/posts/crypto-markets/crypto_header.jpg)" href="https://blog.patricktriest.com/analyzing-cryptocurrencies-python/">
<section class="featured-post-content">
<h2>Analyzing Cryptocurrency Markets Using Python</h2>
</section>
</a>
<a class="read-next-story featured-post" style="background-image: url(https://cdn.patricktriest.com/blog/images/posts/async-await/async_await_header.png)" href="https://blog.patricktriest.com/what-is-async-await-why-should-you-care/">
<section class="featured-post-content">
<h2>Async/Await Will Make Your Code Simpler</h2>
</section>
</a>
<a class="read-next-story featured-post" style="background-image: url(https://cdn.patricktriest.com/blog/images/posts/titanic-ml/titanic.jpg)" href="https://blog.patricktriest.com/titanic-machine-learning-in-python/">
<section class="featured-post-content">
<h2>Would You Survive the Titanic? A Guide to Machine Learning in Python</h2>
</section>
</a>
</div>
<a href="https://blog.patricktriest.com/text-search-docker-elasticsearch/#" class="featured-post-button" id="next-button"><i class="material-icons">navigate_next</i></a>
<a href="https://blog.patricktriest.com/text-search-docker-elasticsearch/#" class="featured-post-button" id="prev-button"><i class="material-icons">navigate_before</i></a>
</section>
</div>
<p class="disqus-warning">Note - Disqus is a great commenting service, but it also embeds a lot of Javascript analytics trackers. If you want to keep your browsing data private, you can disable these trackers from your "Disqus" account settings, in the Acount -&gt; Personalization page.</p>
<div id="disqus_thread"><iframe id="dsq-app6741" name="dsq-app6741" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 2255px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
<script>
            var disqus_config = function () {
                this.page.url = 'http://blog.patricktriest.com/text-search-docker-elasticsearch/';
                this.page.identifier = 'ghost-5a63908e4305a908e18d4d8c';
            };

            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://blog-patricktriest.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
</main>
<aside class="read-next">
<a class="read-next-story prev " style="background-image: url(https://blog-images.patricktriest.com/uploads/Matrix.jpg)" href="https://blog.patricktriest.com/building-an-encrypted-messenger-with-javascript/">
<section class="post">
<h2>An Introduction To Utilizing Public-Key Cryptography In Javascript</h2>
<p>Build an end-to-end RSA-2048 encrypted messaging app using Socket.io and Vue.js.</p>
</section>
</a>
</aside>
<section class="gh-subscribe gh-subscribe-dark">
<div>
<h2>Get the latest posts delivered to your inbox.</h2>
<div class="subscription-disclaimer inner">
<p>I hate spam. I promise not to send many emails.</p>
</div>
<form method="post" action="https://blog.patricktriest.com/subscribe/" class="">
<input class="confirm" type="hidden" name="confirm"><input class="location" type="hidden" name="location"><input class="referrer" type="hidden" name="referrer">
<div class="form-group">
<input class="subscribe-email" type="email" name="email" placeholder="Your email address">
</div>
<button class="" type="submit"><span>Subscribe</span></button>
<script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>
<span class="gh-subscribe-rss"><a href="https://blog.patricktriest.com/rss/">or subscribe via RSS</a></span>
</div>
</section>
<footer class="site-footer clearfix">
<section class="copyright"><a href="https://blog.patricktriest.com/">Break | Better</a> © 2019</section>
<section class="poweredby">
<a href="https://blog.patricktriest.com/">Home</a> |
<a href="https://blog.patricktriest.com/resources">Resources</a> |
<a href="https://blog.patricktriest.com/attribution">Attribution</a> |
<a href="https://blog.patricktriest.com/contact">Contact</a>
</section>
</footer>
</div>
<script type="text/javascript" src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/jquery-1.12.0.min.js"></script>
<script type="text/javascript" src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/prism.js"></script>

<script type="text/javascript" src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/jquery.fitvids.js"></script>
<script type="text/javascript" src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/index.js"></script>


<iframe style="display: none;" src="./Building a Full-Text Search App Using Docker and Elasticsearch_files/saved_resource(1).html"></iframe></body><div id="cye-workaround-body" style="position: absolute; left: 0px; top: 0px; z-index: -2147483646; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(17, 17, 17); height: 51199px; width: 1479px;"></div><div id="cye-workaround-body-image" style="position: absolute; left: 0px; top: 0px; z-index: -2147483645; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0); height: 51199px; width: 1479px;"></div></html>
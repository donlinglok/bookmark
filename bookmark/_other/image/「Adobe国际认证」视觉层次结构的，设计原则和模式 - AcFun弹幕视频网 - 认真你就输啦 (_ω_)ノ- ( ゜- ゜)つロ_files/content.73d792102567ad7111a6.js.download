(window.webpackJsonp=window.webpackJsonp||[]).push([["article/widget/content/content"],{"./article/widget/content/content.es6":function(e,t,a){"use strict";a.r(t);var n=a("../node_modules/@babel/runtime/helpers/extends.js"),i=a.n(n),r=(a("../node_modules/@ac/Ajs/dist/A.min.js"),a("../node_modules/jquery/dist/jquery.js")),o=a.n(r),s=a("../node_modules/exif-js/exif.js"),c=a.n(s),l=a("./common/widget/header/user.es6"),u=a("../node_modules/@ac/ubb/dist/ubb.esm.js"),d=a("../node_modules/@ac/emotionsdk/dist/emotion.es5.js"),f=a("./common/static/js/likeLog.es6"),g=a("./common/static/js/common.es6");A.ready((function(){if(globalConfig.version="1.0.0",!system)throw new Error("全局system变量不存在");system.path={short:globalConfig.oldPath};var e=articleInfo.parts[0].content,t=new d.a({dev:!1},(function(){e=t.convertEmotionCodeToHtml(e,"ubb-emotion"),e=Object(u.filterOutByXSS)(e),o()(".article-content").append(e)}));o()(".art-title-census .comcount").on("click",(function(){o()("html,body").animate({scrollTop:o()(".comment-area").offset().top-100},1e3)}));var a=o()(".census-right .likecount"),n=o()("#article-operation .likecount");Object(f.initArticleLikeLog)({likeTopDom:a[0],likeBottomDom:n[0]});var r,s={kpn:"ACFUN_APP",kpf:"PC_WEB",subBiz:"mainApp",interactType:1,objectType:3},m=articleInfo.isLike,p=articleInfo.likeCount,h=articleInfo.articleId,v="acfun.midground.api",b=Object(g.getTokenGen)(v),w=Object(g.throttle)((function(e,t){if(l.userInfo.isLogin()){e.addClass("disabled");var a,n,r=e.find("span");m?(a="/rest/zt/interact/delete",n=i()({},s,{objectId:h})):(a="/rest/zt/interact/add",n=i()({},s,{objectId:h})),b().then((function(i){if(0==i.result){n["acfun.midground.api_st"]=i["acfun.midground.api_st"],n.userId=i.userId,n.extParams={},n.extParams.showCount=likeLog.showCount?likeLog.showCount.toString():"0",n.extParams.scrollCount=likeLog.scrollCount?likeLog.scrollCount.toString():"0",o.a.ajax({type:"post",url:likeDomain+a,data:n,xhrFields:{withCredentials:!0}}).done((function(a){var n;(e.removeClass("disabled"),1==a.result)?((m=!m)?(n="LIKE",p++,e.find(".icon").removeClass("action"),t.find(".icon").removeClass("action"),e.find(".icon").addClass("action"),e.find(".icon").on("animationend",(function(){setTimeout((function(){e.find(".icon").removeClass("action"),e.addClass("active")}),45)})),t.addClass("active")):(n="CANCEL_LIKE",p--,e.removeClass("active"),t.removeClass("active"),e.find(".icon").removeClass("action"),t.find(".icon").removeClass("action")),r.text(p?Object(g.parsePts)(p):"点赞"),t.find("span").text(p?Object(g.parsePts)(p):"点赞"),A.emit(n,{},"CLICK"),m?A.emit("global::success","点赞成功"):A.emit("global::success","取消点赞成功")):A.emit("global::error",a.error_msg)})).fail((function(t){e.removeClass("disabled"),A.emit("global::error",m?"操作失败，请稍后再试～":"点赞操作失败，请稍后再试～"),console.warn(t)}))}else console.warn("点赞失败")})).catch((function(e){A.emit("global::error",m?"操作失败，请稍后再试～":"点赞操作失败，请稍后再试～"),console.warn(e)}))}else location.href=globalConfig.domain+"/login/?returnUrl="+encodeURIComponent(location.href)}),100);a.find("span").text(p?Object(g.parsePts)(p):"点赞"),n.find("span").text(p?Object(g.parsePts)(p):"点赞"),a.click((function(){a.hasClass("disabled")||w(a,n)})),n.click((function(){n.hasClass("disabled")||w(n,a)})),o()(".J_banana").hover((function(){0==o()(this).data().status&&(o()(this).find(".div-banana").show(),A.emit("BANANA_SELECT_FLOAT_LAYER",{content_type:"article",resourceType:"article"},"SHOW"))}),(function(){var e=o()(this);r=setTimeout((function(){e.find(".div-banana").hide()}),100)})),o()(".div-banana").hover((function(){clearTimeout(r)}),(function(){})),o()(".reportAction").click((function(){var e="/report?type=3&proof="+encodeURIComponent(articleInfo.title)+"&rid="+articleInfo.articleId+"&duid="+articleInfo.user.id+"&url="+encodeURIComponent(location.href);window.open(e)}));setTimeout((function(){var e,t,a,n,i,r,s;for(null==(e=JSON.parse(localStorage.getItem("cache")))&&(e={history:{views:null}}),r=s=0,n=(t=null!=(a=e.history).views?a.views:a.views=[]).length;s<n;r=++s)if(i=t[r],articleInfo.articleId==i.aid){t.splice(r,1);break}return t.push({time:o.a.now(),date:articleInfo.createTime,aid:articleInfo.articleId,title:articleInfo.title,cid:articleInfo.channel.id,preview:articleInfo.coverUrl,uid:articleInfo.user.id,name:articleInfo.user.name,avatar:articleInfo.user.headUrl,cont:null,channelName:articleInfo.channel.name,type:"article"}),t.length>(window.localStorage?100:20)&&t.splice(0,1),e.history.views=t,e=JSON.stringify(e),localStorage.setItem("cache",e)}),1e4),o()("#article-up .message-back").on("click",(function(){if(l.userInfo.isLogin()){var e=o()("#area-comment:visible,#comment:visible").offset().top;o()("html,body").animate({scrollTop:e-100},500)}else window.location.href="/login/?returnUrl="+encodeURIComponent(location.href)})),setTimeout((function(){o.a.collect()}),500),o.a.collect=function(e){var t,a,n,i,r,s,c;o.a.get("/rest/pc-direct/user/userInfo",{userId:window.articleInfo.user.id}).done((function(e){var t=0===e.result&&e.profile.isFollowed,a=0===e.result&&e.profile.userId==l.userInfo.getUid();0===e.result&&e.profile.isFollowing?o()(".up-operate").find(".focus").addClass("alfocus").text(t&&!a?"已互粉":"已关注").data().status=1:o()(".up-operate").find(".focus").removeClass("alfocus").text(t?"回粉":"关注").data().status=0})),o.a.get("/rest/pc-direct/resource/getTagList",{resourceId:articleInfo.articleId,tagResourceType:2}).done((function(e){if(0==e.result){if(n=o()("#bd_tag"),c=o()("#temp-tag-view").html(),a="",(s=e.tags)&&s.length){for(i=0,r=s.length;i<r;i++)t=s[i],a+=o.a.parseTemp(c,{tid:t.tagId,name:o.a.parseSafe(t.tagName)});n.html(a)}1!=o.a.user.group&&2!=o.a.user.group||n.find(".icon-delete1").remove(),articleInfo.allowed_add_tag&&n.find(".add").length&&(n.find(".add").data().status=1),e.tags&&e.tags.length>=10&&n.find(".add").length&&(n.find(".add").data().status=2)}}))},o()(".collectcount .icon").off("click").on("click",(function(){if(l.userInfo.getUid()!=articleInfo.user.id){var e=o()(".collectcount").hasClass("active"),t=e?"/rest/pc-direct/unFavorite":"/rest/pc-direct/favorite",a=e?{resourceIds:articleInfo.articleId,resourceType:3}:{resourceId:articleInfo.articleId,resourceType:3};if(!l.userInfo.isLogin())return window.location.href="/login/?returnUrl="+encodeURIComponent(location.href);o.a.ajax({url:t,type:"post",beforeSend:function(e){e.setRequestHeader("udid",l.userInfo.getDid())},data:a,xhrFields:{withCredentials:!0}}).done((function(t){if(0==t.result){var a=o()(".collectcount span"),n=articleInfo.stowCount;e?(o()(".collectcount").removeClass("active"),A.emit("global::success","已取消当前文章收藏"),n=--n<0?0:n,a.text(o.a.parsePts(n)),A.emit("CANCEL_COLLECTION",{},"CLICK")):(o()(".collectcount").addClass("active"),A.emit("global::success","已收藏"),a.text(o.a.parsePts(++n)),A.emit("COLLECTION",{},"CLICK")),articleInfo.stowCount=n}})).fail((function(){return A.emit("global::warning","操作失败，请稍后再试。")}))}else A.emit("global::warning","不能收藏自己哦～")})),o()(".sharecount").hover((function(e){o()(this).find(".sharehead").addClass("active")}),(function(e){o()(this).find(".sharehead").removeClass("active")})),o()(".parts-container").delegate("li","click",(function(){o()(".article-content").empty();var e=o()(this);if(o()("#up-contvideo").show(),!e.hasClass("active")){e.addClass("active").siblings("li").removeClass("active");var t=e.attr("data-index");articleInfo.superUbb?o()(".article-content").html(Object(u.ubb2html)(articleInfo.parts[t].content)):o()(".article-content").html(Object(u.filterOutByXSS)(articleInfo.parts[t].content))}}));var I=o()(".parts-container");parseInt(I.css("height"),10)>84&&(I.addClass("cover"),o()(".showall").show()),o()("#article-tags").find(".showall").on("click",(function(){var e=o()(this);I.hasClass("cover")?(e.text("收起共 "+articleInfo.parts.length+" Part"),I.removeClass("cover")):(e.text("展开共 "+articleInfo.parts.length+" Part"),I.addClass("cover"))})),o.a.makePager=function(e){var t,a={num:1,count:0,size:20,long:7,haslast:!1,hasfirst:!0,hasjumpPage:!1};if(e&&o.a.extend(a,e),(t={total:a.totalPage||Math.ceil(a.count/a.size),num:a.num,hasjumpPage:a.hasjumpPage}).total>1){if(t.fore=t.num>=5?'<span class="pager pager-fore" data-page="'+(t.num-1)+'"><i class="icon icon-chevron-left" title="上一页"></i></span>':"",t.hind=t.num!==t.total?'<span class="pager pager-hind" data-page="'+(1+(0|t.num))+'"><i class="icon icon-arrow-slim-right" title="下一页"></i></span>':"",a.haslast?t.last=t.num!==t.total?'<span class="pager pager-first" data-page="'+t.total+'"><i class="icon icon-step-forward" title="最末"></i></span>':"":t.last="",a.hasfirst?t.first=t.num>=5?'<span class="pager pager-last" data-page="1"><i class="icon icon-step-backward" title="最初"></i></span>':"":t.first="",t.here='<span class="pager pager-here active" data-aa="11" data-page="'+t.num+'">'+t.num+"</span>",t.fores="",t.num<=4)for(var n=1;n<t.num;n++)t.fores=t.fores+'<span class="pager pager-hinds" data-page="'+n+'">'+n+"</span>";else for(n=t.num-3;n<t.num;n++)t.fores=t.fores+'<span class="pager pager-hinds" data-page="'+n+'">'+n+"</span>";if(t.hinds="",t.total<a.long&&(a.long=t.total),t.num<=4)for(n=t.num+1;n<=a.long;n++)t.hinds=t.hinds+'<span class="pager pager-hinds" data-page="'+n+'">'+n+"</span>";else for(n=t.num+1;n<=t.num+3;n++)n<=t.total&&(t.hinds=t.hinds+'<span class="pager pager-hinds" data-page="'+n+'">'+n+"</span>");return t.hasjumpPage?t.html='<div id="'+(a.id||"")+'" class="area-pager '+(a.class||"")+'">'+(a.before||"")+t.first+t.fore+t.fores+t.here+t.hinds+t.hind+t.last+'<span class="hint">共'+t.total+"页</span>"+(a.after||"")+'<span class="clearfix"></span> </div>':t.html='<div id="'+(a.id||"")+'" class="area-pager '+(a.class||"")+'">'+(a.before||"")+t.first+t.fore+t.fores+t.here+t.hinds+t.hind+t.last+'<span class="hint">当前页：'+t.num+"/"+t.total+"页</span>"+(a.after||"")+'<span class="clearfix"></span> </div>'}return""},o.a.require=function(e,t){var a,n,i,r,s,c,l,u;c=e,n=t||function(){return null},l=(a=o.a.require).cache||(a.cache={}),u=globalConfig.version,i=[(globalConfig.debug?".js":".min.js")+u,".css"+u];var d=function(e,t){var a;return l[e]?1===l[e]?n():l[e].add(n):((l[e]=o.a.Callbacks("once")).add(n),a=globalConfig.path+"/",o.a.getScript(a,(function(){return l[e].fire(),l[e]=1})))};switch(s=function(e,t){var a;if(e="style-require-"+e,a=globalConfig.path,!o()("#"+e).length)return o()("<link>").attr({id:e,href:a,rel:"stylesheet"}).appendTo("head")},c){case"comm":return l.comm?n():(s("comm"),o.a.getScript(system.path.short+"/project/homura/script/comm"+i[0],(function(){return l.comm=1,n()})));case"qrcode":return d("qrcode");case"jqueryui":return d("jqueryui");case"transit":return d("transit");case"chart":return d("chart");case"ubb":return d("ubb");case"canvas":return l.canvas?n():(r=function(){return l.canvas=1,n()},null!=o()("<canvas>")[0].getContext?r():o.a.getScript(system.path.short+"/script/excanvas.min.js",r));case"editor":if(l.editor)return n();break;case"ready":return l.ready?n():system.func.ready((function(){return l.ready=1,n()}));default:return d(c)}},o.a.delay=function(e,t,a){var n,i,r;if(e&&t>=0&&a)return(i=(n=o.a.delay).cache||(n.cache={}))[e]||(i[e]={time:0,timer:null}),r=function(){return i[e].time=o.a.now(),"function"==typeof a?a():void 0},o.a.now()-i[e].time>t?r():(clearTimeout(i[e].timer),i[e].timer=setTimeout(r,t));o.a.i("[$.delay()]#7")},o.a.fn.readyPager=function(e,t){var a;if(a={name:"$.fn.readyPager()",callback:t},e)switch(o.a.type(e)){case"object":o.a.extend(a,e),a.name="$.fn.readyPager()";break;case"function":a.callback=e}return this.length?this.each((function(){var e;if((e=o()(this)).delegate("span.pager:not(.active)","click",(function(){return a.callback(o()(this).data().page)})),a.addon)return e.delegate("input.ipt-pager","focus",(function(){return o()(this).select()})).delegate("input.ipt-pager","keyup",(function(){var e,t,a;return e=o()(this),a=((a=(t=o.a.trim(e.val()).length)?32+8*(t-1):32)>240?240:void 0)-6,e.css({width:a})})).delegate("input.ipt-pager","keydown",(function(e){var t;return t=o()(this).siblings("button.btn-pager").eq(0),13===e.which?t.click():-1!==o.a.inArray(e.which,[8,35,36,37,39,48,49,50,51,52,53,54,55,56,57,58,96,97,98,99,100,101,102,103,104,105])&&void 0})).delegate("button.btn-pager","click",(function(){var e,t,n,i,r;return e=o()(this).siblings("input.ipt-pager").eq(0),(n=null!=(i=parseInt(e.val()))?i:1)<1&&(n=1),n>(t=null!=(r=e.data().max)?r:65535)&&(n=t),a.callback(n)}))})):o()()};var C,y,k=[].slice;return function(e,t){var a,n,i,r,s;for(r=[],n=0,i=t.length;n<i;n++)a=t[n],1===(s=a.split(".")).length?r.push(function(){var t;return t=s[0],o.a[t]=function(){var a;return a=1<=arguments.length?k.call(arguments,0):[],o.a.require(e,(function(){return o.a[t].apply(o.a,a)}))}}()):r.push(function(){var t;return t=s[1],o.a.fn[t]=function(){var a,n;return n=1<=arguments.length?[].slice.call(arguments,0):[],a=this,o.a.require(e,(function(){return a[t].apply(a,n)})),a}}())}("win",["curtain"]),y={list:[],index:0,scale:100},o()(".article-content").find("img:not(.img-emot-ac)").each((function(){var e;if(!(e=o()(this)).parents(".edui-insertvideo-aid"))return y.list.push(e.attr("src"))})),o()("#pc"),o()(".article-content").delegate("img:not(.img-emot-ac):not([data-videopic='comic-filt-img'])","click",(function(e){e.preventDefault(),o()("#nav").hide(),y.list=[],o()(".article-content").find("img:not(.img-emot-ac)").each((function(){var e;(e=o()(this)).parents(".edui-insertvideo-aid").length||y.list.push(e.attr("src"))}));var t=o()(".article-content img:not(.img-emot-ac):not([data-videopic='comic-filt-img'])").index(o()(this));y.enter(t)})),y.exit=function(){return o()("#nav").show(),globalConfig.manga=0,o()(document.body).css("overflow","visible").removeClass("manga"),o()("#allcover").hide(),o()("#curtain").hide(),o()("#style-insert-manga, #box-image-manga, #area-tool-manga, #prev-manga, #next-manga, #pager-manga").remove(),o()(document).off("keydown.manga"),A.emit("global::success","退出读图模式")},y.setPager=function(e){return o()("#pager-manga").html(o.a.makePager({count:y.list.length,num:e,size:1,long:3}))},y.setImg=function(e){return o.a.delay("setImgManga",200,(function(){var t,a;return t=o()("#box-image-manga"),a=t.find("img"),y.index=e,y.scale=100,y.setPager(e+1),a.stop().animate({opacity:0},200,(function(){var n,i,r,s;return a.remove(),(i=new Image).src=y.list[e],r=o()(window),i.onload=function(){s=i.width,n=i.height,s>r.width()&&(s=r.width(),n=s*i.height/i.width),n>r.height()&&(n=r.height(),s=i.width*n/i.height),t.data({width:s,height:n}).css({width:s,height:n,top:.5*(r.height()-n),left:.5*(r.width()-s)}).prepend('<img src="'+i.src+'">'),(a=t.find("img")).on("load",(function(){!function(e){var t;c.a.getData(e,(function(){6===(t=c.a.getTag(e,"Orientation"))?o()(e).css({transform:"rotate(90deg)"}):3===t?o()(e).css({transform:"rotate(180deg)"}):8===t&&o()(e).css({transform:"rotate(-90deg)"})}))}(this)}))},a.animate({opacity:1},200)}))}))},y.next=function(){return y.index>=y.list.length-1?(A.emit("global::warning","已到达最后一页，返回第一页"),y.setImg(0)):y.setImg(y.index+1)},y.prev=function(){return y.index<=0?(A.emit("global::warning","已到达第一页，返回最后一页。"),y.setImg(y.list.length-1)):y.setImg(y.index-1)},y.zoom=function(e){var t,a,n,i,r,s,c,l,u,d;if(t=o()("#box-image-manga"),1===e||"up"===e?(y.scale=y.scale+10,y.scale>500&&(y.scale=500)):(y.scale=y.scale-10,y.scale<20&&(y.scale=20)),20<(s=y.scale)&&s<500)return c=parseInt(t.css("top")),i=parseInt(t.css("left")),u=t.width(),a=t.height(),r=i+.5*(u-(d=t.data().width*y.scale*.01)),l=c+.5*(a-(n=t.data().height*y.scale*.01)),t.css({width:d,height:n,left:r,top:l})},y.scroll=function(e){return o.a.delay("zoomManga",10,(function(){var t;if(globalConfig.manga)return t=0,e||(e=window.event),e.wheelDelta?(t=e.wheelDelta/120,window.opera&&(t=-t)):e.detail&&(t=-e.detail/3),y.zoom(t>0?1:-1)}))},y.enter=function(e){return globalConfig.manga=1,o.a.now()/864e5|0,globalConfig.version.replace(/\./g,""),C='<div id="box-image-manga"> <img src="'+y.list[e]+'"> </div> <div id="prev-manga" class="no-select" title="上一页"><i class="icon icon-arrow-round-left"></i></div> <div id="next-manga" class="no-select" title="下一页"><i class="icon icon-arrow-round-right"></i></div> <div id="area-tool-manga"> <a id="btn-feedback-manga" class="btn primary" href="/a/ac1468010" target="_blank"><i class="icon icon-helps"></i>使用帮助</a> <a id="btn-quit-manga" class="btn danger"><i class="icon icon-delete"></i>退出读图模式</a> <span class="clearfix"></span> </div> <div id="pager-manga"></div>',o()("#area-window").prepend(C),o()("#allcover").show(),o()("#curtain").hide(),o()("#pager-manga").mouseenter((function(){return o()(this).stop(!0,!1).animate({opacity:1},200)})).mouseleave((function(){return o()(this).stop(!0,!1).animate({opacity:1},2e3).animate({opacity:0},500)})).mouseleave(),o()("#box-image-manga").mouseover((function(e){return o.a.delay("manga",20,(function(){return y.position=[e.pageX,e.pageY]}))})),o()("#next-manga").click(y.next),o()("#prev-manga").click(y.prev),o()("#allcover").click((function(e){return e.pageX<.5*o()(window).width()?y.prev():y.next()})),o()("#btn-quit-manga").click(y.exit),o()(document).off("keydown.manga").on("keydown.manga",(function(e){var t;switch(t=function(t){return e.preventDefault(),t()},e.which){case 27:return t((function(){return y.exit()}));case 33:case 37:return t((function(){return y.prev()}));case 38:return t((function(){return y.zoom(1)}));case 10:case 13:case 32:case 34:case 39:return t((function(){return y.next()}));case 40:return t((function(){return y.zoom(-1)}));case 36:return t((function(){return y.setImg(0)}));case 35:return t((function(){return y.setImg(y.list.length-1)}))}})),window.addEventListener&&window.addEventListener("DOMMouseScroll",y.scroll,!1),window.onmousewheel=document.onmousewheel=y.scroll,o()(document.body).css("overflow","hidden").addClass("manga"),y.setImg(e),o()("#pager-manga").readyPager({callback:function(e){return y.setImg(e-1)}}),A.emit("global::success","进入读图模式。\n 您可以使用←和→键左右翻页；\n 使用↑和↓键缩放画面；\n 按下Esc键退出读图模式。")}}))}},[["./article/widget/content/content.es6","runtime","jquery","@ac/Ajs","@ac/bigpipejs","common/static/js/common","common/widget/header/user","@babel/runtime","webpack","@ac/ubb","common/static/js/likeLog","@ac/emotionsdk","exif-js"]]]);
(window.webpackJsonp=window.webpackJsonp||[]).push([["common/widget/header/header"],{"./common/widget/header/header.es6":function(e,t,i){"use strict";i.r(t);i("../node_modules/@ac/Ajs/dist/A.min.js");var s=i("../node_modules/jquery/dist/jquery.js"),a=i.n(s),n=i("./common/static/js/common.es6"),r=i("./common/widget/header/user.es6"),o=i("./common/widget/header/newToast/toast.es6"),c=0,l=1,h='\n    <div class="header-history">\n        <a href="[url]" target="_blank" class="header-history-left">\n            <img src="[cover]" />\n            <div class="progress" style="width:[progressWidth]%"></div>\n        </a>\n        <div class="header-history-right">\n            <a href="[url]" target="_blank" class="title">[title]</a>\n            <p class="viewed-detail">\n                <i class="device [deviceType]"></i>\n                <span>[bangumiEpisodeName] [playedSecondsShow]</span>\n            </p>\n        </div>\n    </div>\n',u="",d="",g="";function m(e,t,i,s){switch(e){case 1:return"/bangumi/aa"+t+"_"+s+"_"+s;case 2:return"/v/ac"+t+(i>0?"_"+(i+1):"");default:return"/"}}var y=["www.acfun.cn","preonline-www.acfun.cn"];function p(){var e={total:0,items:[]};try{a()("#guide-msg-list").find(".badget").each((function(){parseInt(a()(this).text(),10)>0&&("99+"===a()(this).text()?e.total+=parseInt("100",10):e.total+=parseInt(a()(this).text(),10))})),e.total=e.total>99?"99+":e.total}catch(e){console.log("parseError.",e)}e.total?a()(".guide-msg .icon-dao-hang-message").find(".badget").text(e.total):a()(".guide-msg .icon-dao-hang-message").find(".badget").text(""),a()(".guide-item.guide-msg").find(".badget").each((function(e,t){""===t.innerText?a()(t).css("display","none"):a()(t).css("display","inline-block")}))}function f(e){if(e){var t;try{t=JSON.parse(localStorage.getItem("searchCache"))||[]}catch(e){t=[]}(t=t.filter((function(t){return t!==e}))).unshift(a.a.xssFilter(e)),t.splice(8),localStorage.setItem("searchCache",JSON.stringify(t))}}t.default=function(){A.ready((function(){var e=A.Cookie.getCookie;new A.Widget({el:"#header",events:{"click .search-btn":"actionSearch","focus #search-text":"onSearchInputFocus","blur #search-text":"onSearchInputBlur","mouseleave .search-result":"hideSearchResultPanel","click .search-result .sug ul":"onSugULClick","click .search-result .rec ul":"onRecULClick","click .search-history-body":"onHistoryWordClick","keyup #search-text":"onInputKeyUp","click .clear-history":"clearSearchHistory"},created:function(){var e=this;if(this.$form=this.el.querySelector(".form"),this.$searchInput=this.el.querySelector("#search-text"),this.$searchResultContainer=this.el.querySelector(".search-result"),this.$searchHistoryOps=this.$searchResultContainer.querySelector(".search-history-tool"),this.$searchHistory=this.$searchResultContainer.querySelector(".search-history-body"),this.$sugPanel=this.$searchResultContainer.querySelector(".sug"),this.$sugList=this.$sugPanel.querySelector("ul"),this.$recPanel=this.$searchResultContainer.querySelector(".rec"),this.$niudan=this.el.querySelector(".niudan"),this.$niudan&&(this.$niudan.onclick=this.niudanClick),this.canGetBalance=!0,this.fillInSearchHistory(),this.searchMode=c,this.creativeTip(),r.userInfo.isLogin()){var t=!0;location&&y.indexOf(location.host)>-1&&(t=!1),i.e("@ac/sdk-pay").then(i.t.bind(null,"../node_modules/@ac/sdk-pay-common/build/index.min.js",7)).then((function(i){e.paysdk=new i.default({dev:t}),e.paysdk.on("rechargeSuccess",(function(e,t){document.querySelector(".guide-user .user-balance").innerText=t})),document.querySelector(".guide-user").addEventListener("mouseenter",(function(){e.getBalance()}));var s=document.querySelector(".guide-user .go-recharge");s&&s.addEventListener("click",(function(){e.paysdk&&e.paysdk.show({targetAcoinAmount:0})}))})),a.a.getScript(window.globalConfig.imsdkcdn,(function(){e.watchIMMsgCountUpdate(),p()})),this.loginBrowseHistory()}else this.unLoginBrowseHistory();var s,n,o,l=a()("#header"),h=l.find(".nav-sub"),u=h.find(".nav-sub-con"),d=function(e){o=setTimeout((function(){l.removeClass("hover").find("li").removeClass("hover"),h.find("ul").hide()}),e>=0?e:1e3)};a()(".channel-list-wrapper>ul li").hover((function(){var e=a()(this),t=a()(this).attr("data-category");clearTimeout(n),clearTimeout(o),s=setTimeout((function(){if(e.addClass("hover").siblings("li").removeClass("hover"),!u.find("ul[data-category="+t+"]").length)return d(150),!1;l.addClass("hover");var i=h.find("ul"),s=h.find("[data-category="+t+"]");i.hide();var a=u.offset().left,n=e.offset().left-a-parseInt((s.outerWidth()-e.outerWidth())/2,10),r=(n=n<0?0:n)+s.outerWidth()-u.outerWidth();n=r>0?n-r:n,s.css({left:n}).show()}),150)}),(function(){clearTimeout(s),n=setTimeout((function(){l.removeClass("hover").find("li").removeClass("hover"),h.find("li").removeClass("hover").find("ul").hide()}),1e3)})),a()(".nav-sub").hover((function(){clearTimeout(n),clearTimeout(o)}),(function(){d()}))},methods:{niudanClick:function(){window.weblog&&window.weblog.sendImmediately("CLICK",{action:"click_navigation_bar",params:{name:"gashapon_machine"}})},fillInSearchHistory:function(){var e=localStorage.getItem("searchCache");if(e){var t,i="";try{t=JSON.parse(e)||[]}catch(e){t=[]}t.forEach((function(e){i+="<a href='/search?keyword="+encodeURI(e)+"' target='_blank'>"+e+"</a>"})),this.$searchHistory.innerHTML=i,this.el.querySelector(".search-history-box").style.display="block",this.$searchHistoryOps.style.display="block"}else this.$searchHistoryOps.style.display="none"},hideSearchResultPanel:function(e){this.$searchResultContainer.style.display="none",!0!==e&&this.$searchInput.blur()},showSearchResultPanel:function(){this.$searchResultContainer.style.display="block"},switch2RecommendPanel:function(){this.$recPanel.style.display="block",this.$sugPanel.style.display="none",this.searchMode=c;var e=this.$sugList.querySelector("li.active");e&&(e.className=e.className.replace(/(\s+)?active/,""))},switch2SuggestionPanel:function(){this.$recPanel.style.display="none",this.$sugPanel.style.display="block",this.searchMode=l;var e=this.$recPanel.querySelector("li.active");e&&(e.className=e.className.replace(/(\s+)?active/,""))},actionSearch:function(){var e=this.$searchInput.value.trim();f(e);var t="search_result",i="",s="/search?keyword=",a=this.$searchInput.getAttribute("data-url"),n=this.$searchInput.getAttribute("placeholder");e?(s+=encodeURI(e),i=e):a?(s=a,t="content",i=n):n&&(s+=encodeURI(n),i=n),window.open(s),this.hideSearchResultPanel(!0),window.weblog.sendImmediately("CLICK",{action:"CLICK_SEARCH_BUTTON",params:{link_type:t}}),window.weblog.sendImmediately("CLICK",{action:"START_SEARCH",params:{ac_id:"0",atom_id:"0",album_id:"0",action:"content",index:0,req_id:window.weblog.impr.getCurrentReqID(),group_id:window.weblog.impr.getCurrentGroupID(),keyword:i}})},onInputKeyUp:function(e){var t,i=this.$searchInput.value;if(38!==e.which&&40!==e.which)13!==e.which?i?(this.switch2SuggestionPanel(),this.fetchSuggestion()):(this.fillInSearchHistory(),this.showSearchResultPanel(),this.switch2RecommendPanel()):this.actionSearch();else{var s,a;if(this.searchMode===l?(s=this.$sugPanel.querySelector("li.active"),a=this.$sugList):(s=this.$recPanel.querySelector("li.active"),a=this.$recPanel.querySelector("ul")),s){var r=a.querySelectorAll("li"),o=r.length,c=Object(n.findIndex)(r,s);(t=38===e.keyCode?c-1:c+1)<0&&(t=o-1),t>=o&&(t=0),s.className=s.className.replace(/(\s+)?active/,""),a.querySelector("li:nth-child("+(t+1)+")").className+=" active"}else{var h=38===e.keyCode?"last-child":"first-child";a.querySelector("li:"+h).className+=" active"}this.$searchInput.value=a.querySelector("li.active b").innerText}},fetchSuggestion:function(){var e=this,t=this.$searchInput.value,i=new RegExp(t,"i");a.a.ajax({type:"get",url:"/rest/pc-direct/search/suggest?count=6&keyword="+encodeURIComponent(t),dataType:"jsonp"}).done((function(s){var n="";if(0===s.result&&s.suggestKeywords&&s.suggestKeywords.length)for(var r=Math.min(7,s.suggestKeywords.length),o=0;o<r;o++){var c=s.suggestKeywords[o].replace(i,"<i class='light'>"+t+"</i>");n+="<li><a href='/search?keyword="+encodeURI(s.suggestKeywords[o])+"' target='_blank'><b>"+c+"</b></a></li>"}if(!n)return e.$sugList.innerHTML="",e.hideSearchResultPanel(!0),void e.$searchInput.focus();e.$sugList.innerHTML=n,a()(e.$searchInput).is(":focus")&&e.showSearchResultPanel()})).fail((function(){e.$sugList.innerHTML="",e.hideSearchResultPanel(!0),e.$searchInput.focus()}))},clearSearchHistory:function(){localStorage.removeItem("searchCache"),this.el.querySelector(".search-history-box").style.display="none",this.$searchHistory.innerHTML="",this.$searchHistoryOps.style.display="none"},onHistoryWordClick:function(e){if("A"===e.target.tagName){var t=e.target.innerText;this.$searchInput.value=t,f(t),window.weblog.sendImmediately("CLICK",{action:"CLICK_SEARCH_BUTTON",params:{link_type:"search_result"}}),window.weblog.sendImmediately("CLICK",{action:"START_SEARCH",params:{action:"click_history",index:"0",keyword:t}}),this.hideSearchResultPanel(!0)}},onRecULClick:function(e){this.onULClick(e,".rec")},onSugULClick:function(e){this.onULClick(e,".sug")},onULClick:function(e,t){var i=e.target;"B"!==i.tagName&&(i=i.querySelector("b"));var s=i.innerText;f(s),window.weblog.sendImmediately("CLICK",{action:"CLICK_SEARCH_BUTTON",params:{link_type:"search_result"}});var n=a()(".search-result").find(t+" ul b");window.weblog.sendImmediately("CLICK",{action:"START_SEARCH",params:{action:".rec"===t?"click_hot_keyword":"click_associative_word",index:n.index(i)+1,keyword:s}}),this.hideSearchResultPanel(!0)},onSearchInputFocus:function(){this.searchMode===l?this.switch2SuggestionPanel():(this.fillInSearchHistory(),this.switch2RecommendPanel()),this.showSearchResultPanel()},fillInHistroy:function(e,t){var i,s=(new Date).setHours(0,0,0,0),a=s-864e5;e.forEach((function(e){if(!e.disable){t||(e.resourceType="article"===e.type?3:2,e.platform=10,e.resourceId=e.aid||e.bid,e.priority=e.part,e.playedSecondsShow=e.playedSecondsShow||"刚刚开始",e.browseTimeGroup=e.time<a?10:e.time<s?2:1);var i={url:m(e.resourceType,e.resourceId,e.priority,e.itemId),deviceType:Object(n.getPlatform)(e.platform),title:Object(n.xssFilter)(e.title),watchedTime:e.playedSecondsShow,cover:Object(n.cutImageUrlV2)(Object(n.getCdnImgUrl)(e.coverImgInfo),192,108)||e.preview||"http://cdn.aixifan.com/dotnet/20120923/style/image/cover.png",progressWidth:(e.playedSeconds||0)/(e.durationSeconds||0)*100||0,bangumiEpisodeName:e.bangumiItemEpisodeName||"",playedSecondsShow:e.playedSecondsShow||""};switch(e.browseTimeGroup){case 1:0==u.length&&(u+='<h3 class="timeline">今天</h3>'),u+=Object(n.parseTemp)(h,i);break;case 2:0==d.length&&(d+='<h3 class="timeline">昨天</h3>'),d+=Object(n.parseTemp)(h,i);break;case 10:0==g.length&&(g+='<h3 class="timeline">更早</h3>'),g+=Object(n.parseTemp)(h,i)}}})),i=u+d+g;var r=this.el.querySelector(".guide-history");i.length>0?(r.classList.remove("empty"),r.querySelector("ul").innerHTML=i):r.classList.add("empty")},loginBrowseHistory:function(){var e=this;a.a.ajax({type:"post",url:"/rest/pc-direct/browse/history/list",data:{pageSize:20,pageNo:1,resourceTypes:"1,2"},xhrFields:{withCredentials:!0}}).done((function(t){0===t.result&&t.histories&&e.fillInHistroy(t.histories,!0)}))},unLoginBrowseHistory:function(){var e=function(e){void 0===e&&(e=10);var t;try{t=JSON.parse(localStorage.getItem("cache"))}catch(e){t=[]}if(t&&t.history&&t.history.views){var i=t.history.views;return Object(n.isArray)(i)&&i.filter((function(e){return"article"!==e.type})).reverse().splice(0,e)}return[]}(5);e&&this.fillInHistroy(e,!1)},watchIMMsgCountUpdate:function(){var e="unreadCount_immsg";localStorage.getItem(e)||localStorage.setItem(e,JSON.stringify({name:"私信",showCount:"",realCount:0,href:"//message.acfun.cn/im",type:"immsg"})),window.ImSdk&&function(){var e=!0;location&&y.indexOf(location.host)>-1&&(e=!1);var t=new window.ImSdk({dev:e});t.on("unReadCountUpdate",(function(e){var t="99+";e<=99&&(t=e<=0?"":e+""),a()(".message").find(".badget").text(t),p()})),t.on("customMessage",(function(e){var t=e.type,i=e.contentData;"getFansClubMedal"===t&&(o.default.show("恭喜你获得 "+i.uperName+" 的守护徽章“"+i.clubName+"”!"),setTimeout((function(){A.emit("pageProfile::reload",i)}),500))}))}()},changeFollowListShow:function(){var e=document.querySelector("#guide-msg-list .change-listshow"),t=document.querySelector("#guide-msg-list .live-follow-list");e&&(e.classList.contains("icon-list-fold")?(e.classList.remove("icon-list-fold"),e.classList.add("icon-list-unfold"),t.classList.remove("show-all")):(e.classList.add("icon-list-fold"),e.classList.remove("icon-list-unfold"),t.classList.add("show-all")))},getBalance:function(){var e=this;this.paysdk&&this.canGetBalance&&(this.canGetBalance=!1,this.paysdk.getBalance().then((function(e){var t=e.data;0==e.result&&(document.querySelector(".guide-user .user-balance").innerText=t.aCoinAmount)})),setTimeout((function(){e.canGetBalance=!0}),3e3))},creativeTip:function(){var t=localStorage.getItem("creativeTipCount")?localStorage.getItem("creativeTipCount"):0;t<5&&e("auth_key")&&(t++,a()(".guide-item-creative-tips").show(),setTimeout((function(){a()(".guide-item-creative-tips").hide()}),5e3),localStorage.setItem("creativeTipCount",t))},onSearchInputBlur:function(){var e=this;setTimeout((function(){return e.hideSearchResultPanel()}),300)}}});a.a.getScript("//static.yximgs.com/udata/pkg/acfun-pwa/standalone.js").done((function(){})).fail((function(e,t,i){console.log(i)}))}))}}},[["./common/widget/header/header.es6","runtime","jquery","@ac/Ajs","@ac/bigpipejs","common/static/js/common","common/widget/header/user","common/widget/header/newToast/toast"]]]);
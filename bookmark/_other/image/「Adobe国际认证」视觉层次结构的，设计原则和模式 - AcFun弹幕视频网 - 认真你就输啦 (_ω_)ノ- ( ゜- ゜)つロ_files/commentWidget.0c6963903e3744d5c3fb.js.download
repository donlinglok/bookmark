(window.webpackJsonp=window.webpackJsonp||[]).push([["common/widget/comment/commentWidget"],{"./common/widget/comment/commentWidget.es6":function(e,o,n){"use strict";n.r(o),n.d(o,"default",(function(){return d}));var t=n("../node_modules/jquery/dist/jquery.js"),i=n.n(t),a=n("./common/static/js/common.es6");function d(){window.$=window.jQuery=i.a,window.UMEDITOR_CONFIG={initialFrameWidth:"100%"};i.a.extend(window.UMEDITOR_CONFIG,{toolbar:["bold italic underline strikethrough | forecolor  | emotion image "],autoFloatEnabled:!1}),i.a.user={},i.a.dialogAlert={show:function(e){var o='<div class="modal-dialog" id="modalDialog"><div class="modal-content"><header class="modal-header"><a class="close" id="modalClose">&times; </a><h4 class="modal-title f14"></h4></header><div class="modal-body">'+e.content+'</div><footer class="modal-footer"><a class="btn-left" href='+e.href+">"+e.textLeft+' </a><a class="btn-right" id="modalCancel">取消</a></footer></div></div>';i()("body").append(o),i()("#modalDialog").show();var n=i()("#modalDialog");n.after('<div class="modal-bg"></div>'),i.a.dialogAlert.hide(n,"modalClose"),i.a.dialogAlert.hide(n,"modalCancel")},hide:function(e,o){i()("#"+o).off().click((function(){void 0!==e.next()&&(e.next().remove(),e.remove())}))}},i.a.info={show:function(e,o,n){var t=i()("#info-box"),a=n||"info",d=i()('<p class="info '+n+'"><i class="icon icon-'+a+'"></i><span>'+e+"</span></p>");return t.append(d),d.animate({left:0},300),setTimeout((function(){d.animate({left:"-100%"},300,(function(){d.remove()}))}),o||1e4),this},error:function(e){return A.emit("global::error",e)},warning:function(e){return A.emit("global::warning",e)},success:function(e){return A.emit("global::success",e)}};var e,o=i()("#shade-layer");i.a.callPop=function(e,n,t,a,d){var c=i()(".pop"),r=i()(window).scrollTop()+200,l=i()(window).width()/2-170;switch(c.css({top:r,left:l}),e){case"confirm":t=i()("#pop-confirm");break;case"follow":t=i()("#pop-follow");break;default:t=i()(".pop")}switch(n){case"close":c.hide(),o.hide();break;case"open":t.find(".win-hint-ensure").html(a),t.show(),o.show()}switch(e){case"confirm":setTimeout((function(){i()("#btn_cancle_ensure").off(),i()("#btn_ok_ensure").off("click").on("click",(function(){"function"==typeof d?d():console.info("callback:not a function.")})),i()("#btn_cancle_ensure").on("click",(function(){i.a.callPop(e,"close","","","")}))}),500);break;case"follow":setTimeout((function(){i()("#btn-to-follow").off(),i()("#win-btn-close").off(),i()("#btn-to-follow").on("click",(function(){"function"==typeof d?d():console.info("callback:not a function.")})),i()("#win-btn-close").on("click",(function(){i.a.callPop(e,"close","","","")}))}),500)}},i.a.hash=function(){var e,o,n,t,i,a,d,c;if(window.location.hash){for(n={},t=0,i=(e=window.location.hash.toString().replace(/#/,"").split(";")).length;t<i;t++)(null!=(a=(o=[(c=e[t]).replace(/=[\s\S]+/,""),c.replace(/[\s\S]+?=/,"")])[0])?a.length:void 0)&&(null!=(d=o[1])?d.length:void 0)&&(n[o[0]]=o[1]);return n}return{}},i.a.setHash=function(e){var o,n=i.a.extend(i.a.hash(),e);o=i.a.param(n).replace(/(?:&=)||(?:=&)/g,"").replace(/&/g,";"),window.location.hash=o?"#"+o:""};var t,d=function(){var e="article",o=location.pathname;if(/v\/ac/.test(o)?e="v":/bangumi\/a/.test(o)&&(e="bangumi"),"v"===e){var n=window.videoInfo.dougaId,t=Object(a.getHash)("album");return t=t&&t.split(",")[0],{resourceId:n,resourceType:3,type:3,container:document.querySelector(".comment-area .columen-left.fl"),atom_id:String(window.videoInfo.currentVideoId||"0"),ac_id:String(n),album_id:String(t||0),up_id:window.pageInfo.user.id||"0"}}if("bangumi"===e){var i=bangumiData.commentParted?6:2,d=bangumiData.commentParted?window.bangumiData.bangumiId+"_"+window.bangumiData.videoId:window.bangumiData.bangumiId;return bangumiData.showHighlights&&(i=3,d=bangumiData.sidelights[bangumiData.highlightId].contentId),{resourceId:d,resourceType:i,type:2,container:document.querySelector(".comment-area .columen-left.fl"),atom_id:window.bangumiData.currentVideoInfo&&window.bangumiData.currentVideoInfo.id||window.bangumiData.videoId||"0",ac_id:"0",album_id:window.bangumiData.bangumiId,up_id:"0"}}return{resourceId:window.articleInfo.articleId,resourceType:3,type:1,container:document.querySelector(".comment-area .columen-left.fl"),atom_id:String(window.articleInfo.articleId),ac_id:String(window.articleInfo.articleId),album_id:"0",up_id:String(window.articleInfo.user.id)||"0"}};function c(){var o=d();e?e.root.style.display="block":n.e("@ac/acfloorComment").then(n.t.bind(null,"../node_modules/@ac/acfloorComment/dist/acfloorComment.min.js",7)).then((function(){(e=new FloorCommentWidget({resourceId:o.resourceId,resourceType:o.resourceType,type:o.type,container:o.container,showJump2TopBtn:!1,showSwitchButton:!0,atom_id:o.atom_id,ac_id:o.ac_id,album_id:o.album_id,up_id:o.up_id})).on("switch-edition",(function(){i()("#comment").length?(e.root.style.display="none",i()("#comment").show()):n.e("@ac/acfun-comment-pc").then(n.t.bind(null,"../node_modules/@ac/acfun-comment-pc/dist/acfunComment.js",7)).then((function(){r(),e.root.style.display="none"}));var o=d();window.eventBus&&window.eventBus.$emit("loadpage",1,o.resourceId),localStorage.setItem("ac_usp_commMode",2)}))})),localStorage.setItem("ac_usp_commMode",1)}function r(){var e=d();t?t.style.display="block":n.e("@ac/acfun-comment-pc").then(n.t.bind(null,"../node_modules/@ac/acfun-comment-pc/dist/acfunComment.js",7)).then((function(){var o=document.createElement("div");i()(e.container)[0].appendChild(o),window.acfunComm({resourceId:e.resourceId,resourceType:e.resourceType,type:e.type,ele:o,ac_id:e.ac_id,atom_id:e.atom_id,album_id:e.album_id,up_id:e.up_id}),t=i()("#comment")[0],window.eventBus.$on("returnToOldMode",(function(){n.e("@ac/acfloorComment").then(n.t.bind(null,"../node_modules/@ac/acfloorComment/dist/acfloorComment.min.js",7)).then((function(){var e=d();c(),t.style.display="none",window.acEventbus.$emit("loadpage",1,e.resourceId,e.resourceType),localStorage.setItem("ac_usp_commMode",1)}))}))})),localStorage.setItem("ac_usp_commMode",2)}n.e("@ac/umeditor").then(n.t.bind(null,"../node_modules/@ac/umeditor/dist/umeditor.min.js",7)).then((function(){Promise.all([n.e("webpack"),n.e("@ac/ubb")]).then(n.bind(null,"../node_modules/@ac/ubb/dist/ubb.esm.js")).then((function(){n.e("@ac/pager").then(n.t.bind(null,"../node_modules/@ac/pager/dist/pager.min.js",7)).then((function(){switch(+localStorage.getItem("ac_usp_commMode")){case 1:c();break;case 2:r();break;default:c()}setTimeout((function(){window.Qiniu||i.a.getScript("//cdn.aixifan.com/dotnet/20130418/qiniu/moxie.min.js",(function(){i.a.getScript("//cdn.aixifan.com/dotnet/20130418/qiniu/plupload.dev.min.js",(function(){i.a.getScript("//cdn.aixifan.com/dotnet/20130418/qiniu/qiniu.min.js",(function(){}))}))}))}),1e3)}))}))}))}},"./common/widget/comment/commentWidgetNew.es6":function(e,o,n){"use strict";n.r(o),n.d(o,"default",(function(){return r}));var t=n("../node_modules/@babel/runtime/helpers/extends.js"),i=n.n(t),a=n("../node_modules/jquery/dist/jquery.js"),d=n.n(a),c=n("./common/static/js/common.es6");function r(){window.$=window.jQuery=d.a,window.UMEDITOR_CONFIG={initialFrameWidth:"100%"};var e=function(){var e="article",o=location.pathname,n={};if(/v\/ac/.test(o)?e="v":/bangumi\/a/.test(o)&&(e="bangumi"),"v"===e){var t=window.videoInfo.dougaId,i=Object(c.getHash)("album");i=i&&i.split(",")[0],n={pageType:e,resourceId:t,resourceType:3,type:3,container:document.querySelector(".comment-area .columen-left.fl"),atom_id:String(window.videoInfo.currentVideoId||"0"),ac_id:String(t),album_id:String(i||0),up_id:window.pageInfo.user.id||"0"}}else if("bangumi"===e){var a=bangumiData.commentParted?6:2,d=bangumiData.commentParted?window.bangumiData.bangumiId+"_"+window.bangumiData.videoId:window.bangumiData.bangumiId;bangumiData.showHighlights&&(a=3,d=bangumiData.sidelights[bangumiData.highlightId].contentId),n={pageType:e,resourceId:d,resourceType:a,type:2,container:document.querySelector(".comment-area .columen-left.fl"),atom_id:window.bangumiData.currentVideoInfo&&window.bangumiData.currentVideoInfo.id||window.bangumiData.videoId||"0",ac_id:"0",album_id:window.bangumiData.bangumiId,up_id:"0"}}else{n={pageType:e,resourceId:window.articleInfo.articleId,resourceType:3,type:1,container:document.querySelector(".comment-area .columen-left.fl"),atom_id:String(window.articleInfo.articleId),ac_id:String(window.articleInfo.articleId),album_id:"0",up_id:String(window.articleInfo.user.id)||"0"}}return n},o=function(e){for(var o=e+"=",n=document.cookie.split(";"),t=0;t<n.length;t++){for(var i=n[t];" "==i.charAt(0);)i=i.substring(1);if(-1!=i.indexOf(o))return i.substring(o.length,i.length)}return""},t=+localStorage.getItem("ac_usp_commMode"),a="SECONDARY";t&&(a=1===t?"SECONDARY":"FLOOR");var r=e(),l=o("auth_key");!window.weblog&&window.Weblog&&(window.weblog=new window.Weblog({fps:!1,timing:!1,env:/staging|test|local/.test(location.href)?"logger":"production",retries:3,autoPV:!0,useBeacon:!0},{device_id:o("_did")||"",user_id:o("auth_key")||"",safety_id:window.globalConfig.safetyId,global_id:"",version_name:"",product_name:"ACFUN_WEB"}),window.weblog.plug(window.WeblogImpr),window.weblog.impr=weblog.plugins.Impr);var m={req_id:window.weblog.impr.getCurrentReqID(),group_id:window.weblog.impr.getCurrentGroupID(),atom_id:r.atom_id,ac_id:r.ac_id,album_id:r.album_id,up_id:r.up_id,resourceType:r.resourceType,uid:l};n.e("@ac/umeditor").then(n.t.bind(null,"../node_modules/@ac/umeditor/dist/umeditor.min.js",7)).then((function(){n.e("@ac/pc-comment").then(n.t.bind(null,"../node_modules/@ac/pc-comment/dist/pc-switcher-comment.js",7)).then((function(){var o=e(),n=document.createElement("div");d()(o.container)[0].appendChild(n);var r=new window.CommentCore({wrapper:n,sourceId:o.resourceId,sourceType:o.resourceType,useMode:a});window.weblog.sendImmediately("SHOW",{action:"COMMENT_AREA_SHOW",params:i()({},m,{type:t})}),A.on("loadpage",(function(e){r.reload({sourceId:e.sourceId,sourceType:e.sourceType,p:e.p})}));var l=document.querySelector("#to-comm .pts");r.on("load",(function(o){l&&(l.textContent=o.commentCount);var n=e();"bangumi"==n.pageType&&3==n.resourceType&&d()(".video-description .commentCount").html(Object(c.parsePts)(o.commentCount))})),r.on("switch",(function(e){t="FLOOR"===e?2:1;var o=i()({},m,{type:t});window.weblog.sendImmediately("SHOW",{action:"COMMENT_AREA_SHOW",params:o}),localStorage.setItem("ac_usp_commMode",t)})),r.on("add",(function(e){var o=i()({},m,{type:0,comment_id:e.commentId});window.weblog.sendImmediately("CLICK",{action:"COMMENT",params:o})})),r.on("like",(function(e){var o=i()({},m,{type:e.isHot?1:0,comment_id:e.commentId});window.weblog.sendImmediately("CLICK",{action:"LIKE_COMMENT",params:o})})),r.on("unLike",(function(e){var o=i()({},m,{type:e.isHot?1:0,comment_id:e.commentId});window.weblog.sendImmediately("CLICK",{action:"CANCEL_LIKE_COMMENT",params:o})})),r.on("follow",(function(e){var o=i()({},m,{up_id:String(e.userId)});window.weblog.sendImmediately("CLICK",{action:"FOLLOW_UP_OWNER",params:o})})),r.on("videoSeek",(function(e){if(window.player&&e&&e.time){var o=Object(c.timeToSecs)(e.time),n=window.videoInfo&&window.videoInfo.durationMillis||window.bangumiData&&window.bangumiData.currentVideoInfo&&window.bangumiData.currentVideoInfo.durationMillis||0,t=Math.floor(n/1e3);(o=o>t?t:o)>=0&&(d()("html,body").animate({scrollTop:0},1e3),window.player.play(),window.player.seek(o))}}))}))}))}}}]);
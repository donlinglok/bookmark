(window.webpackJsonp=window.webpackJsonp||[]).push([["common/widget/userCard/userCard"],{"./common/widget/userCard/userCard.es6":function(e,t,i){"use strict";i.r(t);i("../node_modules/@ac/Ajs/dist/A.min.js");var o=i("../node_modules/jquery/dist/jquery.js"),n=i.n(o),s=i("./common/widget/header/user.es6"),r=i("./common/static/js/common.es6"),a=new(function(){function e(){this.hasBindEvent=!1,this.canHide=!0,this.userId=void 0}var t=e.prototype;return t.init=function(){this.container=n()("#userCard"),this.avatar=n()("#userCard .user-avatar"),this.title=n()("#userCard .user-name-item"),this.descBtn=n()("#userCard .user-description"),this.followCount=n()("#userCard .followCount"),this.fansCount=n()("#userCard .fansCount"),this.contributeCount=n()("#userCard .contributeCount"),this.message=n()("#userCard .user-to-message"),this.followBtn=n()("#userCard .user-to-follow"),this.userName=n()("#userCard .user-name-item"),this.timeout=null},t.initHandlers=function(e,t){var i=this;n()(e).hover((function(){i.canHide=!1,i.userId=t,n.a.ajax({type:"get",url:"/rest/pc-direct/user/userInfo?userId="+t,xhrFields:{withCredentials:!0}}).done((function(o){if(0==o.result){var s=o.profile;s.headUrl=Object(r.getCdnImgUrl)(s.userHeadImgInfo);var a="/u/"+t;i.avatar.attr("href",a),i.title.attr({href:a,title:"注册于 "+Object(r.parseTime)(s.registerTime)+" (Uid:"+s.userId+") 最后登录于 "+Object(r.parseTime)(parseInt(s.lastLoginTime))}),i.userName.text(s.name),i.avatar.find("img").attr("src",s.headUrl),i.descBtn.html(s.signature),i.followCount.html(s.following),i.fansCount.html(s.followed),i.contributeCount.html(s.contentCount),s.isFollowing?i.followBtn.removeClass("not-follow").addClass("hasFollowed").text("已关注"):i.followBtn.addClass("not-follow").removeClass("hasFollowed").text("关注"),i.container.find(".monkey-verified-icon")[(s.verifiedTypes||[]).includes(1)?"show":"hide"](),i.container.find(".official-verified-icon")[(s.verifiedTypes||[]).includes(2)?"show":"hide"](),i.container.find(".avi-verified-icon")[(s.verifiedTypes||[]).includes(3)?"show":"hide"](),i.container.find(".advanced-danmaku-verified-icon")[(s.verifiedTypes||[]).includes(4)?"show":"hide"](),i.container.find(".up-college-verified")[(s.verifiedTypes||[]).includes(5)?"show":"hide"](),i.message.attr("href","//message.acfun.cn/im?targetid="+t);var l=n()(e).offset();i.container.css({left:l.left+"px",top:l.top+n()(e).height()+"px"}),i.container.fadeIn(200)}})).fail((function(e){console.log(e)}))}),(function(){i.canHide=!0,i.timeout=setTimeout((function(){i.canHide&&i.container.hide(),i.canHide=!0}),150)})),this.hasBindEvent||(this.container.hover((function(){clearTimeout(i.timeout),i.container.show()}),(function(){setTimeout((function(){i.container.hide()}),150)})),this.container.delegate(".user-to-follow","click",(function(){return s.userInfo.isLogin()?s.userInfo.getUid()!=i.userId?i.followBtn.hasClass("hasFollowed")?i.unfollowUser(i.userId):void i.followUser(i.userId):void A.emit("global::warning","不能关注自己呦"):A.emit("global::warning","请先登录!")})),this.container.hover((function(){i.container.show()}),(function(){i.container.fadeOut(150)})),this.hasBindEvent=!0)},t.unfollowUser=function(e){var t=this;n.a.ajax({type:"post",url:"/rest/pc-direct/relation/follow",data:{toUserId:e,action:2},xhrFields:{withCredentials:!0}}).done((function(i){0==i.result?(A.emit("global::success","取消关注成功"),A.emit("unfollow"+e),t.followBtn.removeClass("hasFollowed").text("+ 关注")):A.emit("global::warning","取消关注失败,"+i.error_msg)})).fail((function(e){A.emit("global::warning","取消关注失败,"+e.responseJSON.error_msg)}))},t.followUser=function(e){var t=this;n.a.ajax({type:"post",url:"/rest/pc-direct/relation/follow",data:{toUserId:e,action:1,groupId:0},xhrFields:{withCredentials:!0,xsrfCookieName:""}}).done((function(i){0==i.result?(A.emit("global::success","关注成功"),A.emit("follow"+e),t.followBtn.addClass("hasFollowed").text("已关注")):A.emit("global::warning","关注失败,"+i.error_msg)})).fail((function(e){A.emit("global::warning","关注失败,"+e.responseJSON.error_msg)}))},t.getUserInfo=function(e){n.a.ajax({type:"get",url:"/rest/pc-direct/user/userInfo?userId="+e,xhrFields:{withCredentials:!0}}).done((function(e){return e}))},t.showDeatil=function(e){e.selector&&e.userId&&(this.topOffset=e.topOffset||80,this.leftOffset=e.leftOffset||0,this.init(),this.initHandlers(e.selector,e.userId),this.showDom=n()(e.selector))},e}());t.default=a}}]);
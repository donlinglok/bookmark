(window.webpackJsonp=window.webpackJsonp||[]).push([["newVideo/widget/introduction/introduction"],{"./common/widget/header/img/liveing.gif":function(o,e,n){o.exports=n.p+"common/widget/header/img/liveing.899b242a0dba5a964575.gif"},"./newVideo/widget/introduction/introduction.es6":function(o,e,n){"use strict";n.r(e);n("../node_modules/@ac/Ajs/dist/A.min.js");var i=n("../node_modules/jquery/dist/jquery.js"),t=n.n(i),d=n("../node_modules/@ac/sdk-pay/build/index.min.js"),a=n.n(d),s=n("./common/widget/header/user.es6"),r=n("./common/static/js/url.es6"),l=n("./common/static/js/common.es6"),c=n("./common/widget/userCard/userCard.es6"),u=n("./common/widget/header/img/liveing.gif"),w=n.n(u);e.default=function(){A.ready((function(){window.paySdk||(window.paySdk=new a.a({dev:/dev=1/.test(location.search)}),paySdk.on("go2fiveBanana",(function(){t()('.banana[data-num="5"]').click()})),paySdk.on("showFiveBanana",(function(){window.weblog&&window.weblog.sendImmediately("SHOW",{action:"REWARD_VID_BANANACHECK",params:{}})})),paySdk.on("clickFiveBanana",(function(){window.weblog&&window.weblog.sendImmediately("CLICK",{action:"REWARD_VID_BANANACHECK",params:{}})})),paySdk.on("showPanel",(function(o){"pay"===o?(window.weblog&&window.weblog.sendImmediately("SHOW",{action:"REWARD_VID_WINDOW",params:{}}),window.weblog&&window.weblog.sendImmediately("SHOW",{action:"REWARD_VID_WINDOWBUTTON",params:{}})):(window.weblog&&window.weblog.sendImmediately("SHOW",{action:"DEPOSIT_VID_WINDOW",params:{}}),window.weblog&&window.weblog.sendImmediately("SHOW",{action:"DEPOSIT_VID_WINDOWBUTTON",params:{}}))})),paySdk.on("clickGo2Pay",(function(){window.weblog&&window.weblog.sendImmediately("CLICK",{action:"REWARD_VID_WINDOWBUTTON",params:{}})})),paySdk.on("clickGo2recharge",(function(){window.weblog&&window.weblog.sendImmediately("CLICK",{action:"DEPOSIT_VID_WINDOWBUTTON",params:{}})})),paySdk.on("throwPeachSuccess",(function(o){A.emit("feedPeach",o)}))),function o(){if(videoInfo.staffContribute){var e=[];t.a.ajax({type:"post",url:"/rest/pc-direct/staff/getStaff",data:{resourceId:videoInfo.dougaId,resourceType:2},xhrFields:{withCredentials:!0}}).done((function(n){if(0===n.result){var i=n.upInfo,d=n.staffInfos;videoInfo.staffInfos=d;var a=document.querySelector(".staff-area");[i].concat(d).forEach((function(o,n){var d;if(n){(d=document.createElement("div")).classList.add("staff-details"),o.headUrl=Object(l.getCdnImgUrl)(o.userHeadImgInfo);var r="<div>\n                                    <a href='/u/"+o.id+"' target=\"_blank\" class='staff-avatar' >\n                                        <img src=\""+o.headUrl+"\" class='avatar live-avatar"+(o.liveId?"-animate":"")+"'/>\n                                    </a>";o.liveId?r+='<div class="live-decoration">\n                                    <a href="//live.acfun.cn/live/'+o.id+'" target="_blank">\n                                        <div class="live-decoration-circle live-circle-animate"></div>\n                                \n                                        <div class="live-decoration-status">\n                                            <div class="live-status-text">直播中</div>\n                                            <div class="live-icon">\n                                                <div class="live-status-animate">\n                                                    <img src="'+w.a+'" alt="">\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </a>\n                                </div>\n                        </div>':r+="</div>",r+="<a href='"+(o.liveId?"//live.acfun.cn/live/":"/u/")+o.id+'\' class="staff-name">'+o.name+'</a>\n                                <div class="role">'+o.staffRoleName+"</div>",r+="<div class='follow "+(o.isFollowing?"hidden":"")+"'>+</div>",d.innerHTML=r,a.appendChild(d),e.push({info:o,dom:d})}else d=document.querySelector(".staff-area .up-details");d.querySelector(".follow")&&d.querySelector(".follow").addEventListener("click",(function(e){s.userInfo.isLogin()?s.userInfo.getUid()!=o.id?(A.emit("FOLLOW_BUTTON",{content_id:videoInfo.currentVideoId,parent_content_id:videoInfo.dougaId,cont_type:"douga_atom",author_id:i.id,title:videoInfo.title,up_id:o.id,enter_type:"Joint_contribution",up_owner_type:"list_up_owner"},"CLICK"),t.a.post("/rest/pc-direct/relation/follow",{toUserId:o.id,action:1,groupId:0}).done((function(t){0==t.result?(n||(window.videoInfo.user.isFollowing=!0,window.videoInfo.user.fanCountValue++,window.player.emit("responseRecommend",{eventName:"requestFollow",type:"douga",isFollow:!0,followCount:Object(l.parsePts)(window.videoInfo.user.fanCountValue)})),A.emit("FOLLOW_UP_OWNER",{content_id:videoInfo.currentVideoId,parent_content_id:videoInfo.dougaId,cont_type:"douga_atom",author_id:i.id,title:videoInfo.title,up_id:o.id,enter_type:"Joint_contribution",up_owner_type:"list_up_owner"},"CLICK"),A.emit("global::success","关注["+o.name+"]成功"),(e.currentTarget||e.target).classList.add("hidden")):A.emit("global::warning",t.error_msg)})).fail((function(o){A.emit("global::warning",o.responseJSON.error_msg)}))):A.emit("global::warning","不能关注自己呦"):window.location.href=globalConfig.domain+"/login/?returnUrl="+encodeURIComponent(location.href)})),Array.from(d.querySelectorAll("a")).forEach((function(e){e.addEventListener("click",(function(){A.emit("UP_AVATOR",{content_id:window.videoInfo.currentVideoId,parent_content_id:window.videoInfo.dougaId,cont_type:"douga_atom",author_id:window.videoInfo.user.id,up_id:o.id,title:window.videoInfo.title,position:"Joint_contribution_teams_module"},"CLICK")}))})),n&&c.default.showDeatil({selector:d.querySelector("div"),userId:o.id,topOffset:80,leftOffset:0}),A.on("follow"+o.id,(function(){d.querySelector(".follow").classList.add("hidden"),A.emit("FOLLOW_UP_OWNER",{content_id:videoInfo.currentVideoId,parent_content_id:videoInfo.dougaId,cont_type:"douga_atom",author_id:i.id,title:videoInfo.title,up_id:o.id,enter_type:"Joint_contribution",up_owner_type:"list_up_owner"},"CLICK"),o.id==window.videoInfo.user.id&&(window.videoInfo.user.isFollowing=!0,window.videoInfo.user.fanCountValue++,window.player.emit("responseRecommend",{eventName:"requestFollow",type:"douga",isFollow:!0,followCount:Object(l.parsePts)(window.videoInfo.user.fanCountValue)}))})),A.on("unfollow"+o.id,(function(){d.querySelector(".follow").classList.remove("hidden"),A.emit("CANCEL_FOLLOW_UP_OWNER",{content_id:videoInfo.currentVideoId,parent_content_id:videoInfo.dougaId,cont_type:"douga_atom",author_id:i.id,title:videoInfo.title,up_id:o.id,enter_type:"Joint_contribution",up_owner_type:"list_up_owner"},"CLICK"),o.id==window.videoInfo.user.id&&(window.videoInfo.user.isFollowing=!1,window.videoInfo.user.fanCountValue--,window.player.emit("responseRecommend",{eventName:"requestFollow",type:"douga",isFollow:!1,followCount:Object(l.parsePts)(window.videoInfo.user.fanCountValue)}))}))}))}else o()})).fail((function(e){o()}))}}(),new A.Widget({el:".introduction",events:{"click .desc-operate":"toggleShow","click .follow-up":"follow","click .btn-reward":"reward"},created:function(){this.$introduction=t()(".introduction"),this.$followBtn=t()(".follow-up"),this.intro_desc=this.$introduction.find(".content-description"),this.intro_text=this.intro_desc.find(".description-container"),this.upInfo=window.videoInfo.user,this.staffInfos=[],this.init(),window.intro=this},methods:{init:function(){var o=this;this.handleResize(),A.off("popConfirm::chooseSure"),A.on("popConfirm::chooseSure",(function(){t.a.post("/rest/pc-direct/relation/follow",{toUserId:o.upInfo.id,action:2,groupId:0}).done((function(e){if(0==e.result){var n=t()(".follow-up"),i=o.upInfo.isFollowed;o.upInfo.isFollowing=!1,o.upInfo.fanCountValue--,n.length&&n.removeClass("followed").addClass("not-follow").attr("data-status",0).html((i?"回粉":"关注")+"&nbsp;"+o.upInfo.fanCount),i?A.emit("global::success","TA还在默默关注你哦"):A.emit("global::success","已取消对["+o.upInfo.name+"]关注"),A.emit("CANCEL_FOLLOW_UP_OWNER",{up_id:String(o.upInfo.id)},"CLICK"),window.videoInfo.staffContribute&&document.querySelector(".staff-area .up-details").querySelector(".follow").classList.remove("hidden"),window.player.emit("responseRecommend",{eventName:"requestFollow",type:"douga",isFollow:!1,followCount:Object(l.parsePts)(o.upInfo.fanCountValue)})}else A.emit("global::warning",e.error_msg)})).fail((function(o){A.emit("global::warning",o.responseJSON.error_msg)}))}));var e=this.handleResize.bind(this);window.addEventListener("resize",e),window.player.off("requestFollow"),window.player.on("requestFollow",(function(){o.follow()})),window.player.off("requestUnfollow"),window.player.on("requestUnfollow",(function(){A.emit("popConfirm::chooseSure")})),window.player.off("requestReward"),window.player.on("requestReward",(function(){o.reward()}))},showAllDesc:function(){this.intro_text.removeClass("fold"),this.intro_desc.removeClass("gheight"),this.$introduction.find(".desc-operate").removeClass("open").addClass("close").text("收起")},closeAllDesc:function(){this.intro_text.addClass("fold"),this.intro_desc.addClass("gheight"),this.$introduction.find(".desc-operate").removeClass("close").addClass("open").text("展开")},toggleShow:function(){this.intro_desc.hasClass("gheight")?this.showAllDesc():this.closeAllDesc()},follow:function(){var o=this;s.userInfo.isLogin()?s.userInfo.getUid()!=this.upInfo.id?parseInt(this.$followBtn.attr("data-status"),10)?A.emit("popConfirm::show","是否确定取消关注?"):t.a.post("/rest/pc-direct/relation/follow",{toUserId:this.upInfo.id,action:1,groupId:0}).done((function(e){if(0==e.result){var n=o.upInfo.isFollowed;o.upInfo.isFollowing=!0,A.emit("FOLLOW_UP_OWNER",{up_id:String(o.upInfo.id)},"CLICK"),n?A.emit("global::success","你们成为互粉的好友啦"):A.emit("global::success","关注["+o.upInfo.name+"]成功");var i=t()(".follow-up"),d=++o.upInfo.fanCountValue;d=Object(l.parsePts)(d),i.removeClass("not-follow").addClass("followed").attr("data-status",1).html((n?"已互粉":"已关注")+"&nbsp;"+d),window.videoInfo.staffContribute&&document.querySelector(".staff-area .up-details").querySelector(".follow").classList.add("hidden"),window.player.emit("responseRecommend",{eventName:"requestFollow",type:"douga",isFollow:!0,followCount:d})}else A.emit("global::warning",e.error_msg)})).fail((function(o){A.emit("global::warning",o.responseJSON.error_msg)})):A.emit("global::warning","不能关注自己呦"):window.location.href=globalConfig.domain+"/login/?returnUrl="+encodeURIComponent(location.href)},handleResize:function(){var o=this.$introduction.find(".desc-operate");this.intro_text.removeClass("fold"),o.hasClass("close")&&this.intro_text.height()>44||this.intro_text.height()>this.intro_desc.height()||t()("#bd_tag").length?(this.intro_text.height()>this.intro_desc.height()&&this.intro_text.addClass("fold"),o.show()):this.intro_text.height()!=this.intro_desc.height()||t()("#bd_tag").length||(o.hasClass("close")&&this.intro_text.height()<=44||!o.hasClass("close"))&&o.hide()},reward:function(){window.weblog&&window.weblog.sendImmediately("CLICK",{action:"REWARD_VID_BUTTON",params:{}});var o=window.pageInfo.user.name,e=window.pageInfo.user.id,n=!window.pageInfo.isThrowBanana,i=window.pageInfo.dougaId;if(s.userInfo.isLogin())window.paySdk.show({targetUserName:o,targetUserId:e,resourceId:i,canThrowBanana:n});else{var t=r.URL.addHash(location.href,"reward");location.href="/login/?returnUrl="+encodeURIComponent(t)}}}}),window.weblog&&window.weblog.sendImmediately("SHOW",{action:"REWARD_VID_BUTTON",params:{}}),"#reward"==location.hash&&setTimeout((function(){t()(".btn-reward").click(),location.hash=""}),500)}));var o=videoInfo.staffContribute?".introduction .up-avatar-wrapper":".introduction .up-name";"complete"===document.readyState?c.default.showDeatil({selector:o,userId:videoInfo.user.id}):window.addEventListener("load",(function(){c.default.showDeatil({selector:o,userId:videoInfo.user.id})}))}}},[["./newVideo/widget/introduction/introduction.es6","runtime","jquery","@ac/Ajs","@ac/bigpipejs","common/static/js/common","common/widget/header/user","@ac/sdk-pay","common/widget/userCard/userCard","common/static/js/url"]]]);